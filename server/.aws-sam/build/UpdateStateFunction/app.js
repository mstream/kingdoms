module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=27)}([function(t,e,r){"use strict";r.d(e,"a",(function(){return I}));var n={},a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},c=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},p=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)};function y(t){if(t.hasErrors()){var e=t.input,r=t.context,n=[],a=!0,i=!1,o=void 0;try{for(var u,s=t.errors[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var p=u.value,y=c(p,3),l=y[0],f=y[1],b=y[2],h=b?b.toString():null,v=r.typeOf(j(e,l)).toString(),d=S(t.path.concat(l)),g=`/${l.join("/")}`;n.push({pointer:g,field:d,message:f,expected:h,actual:v})}}catch(t){i=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}return n}}var l=new WeakMap,f=new WeakSet;function b(t,e){try{var r=l.get(t);return!!r&&k(r,e)}catch(t){return!0}}function h(t,e){var r=l.get(t);r||(r=new WeakSet,l.set(t,r)),_(r,e)}function v(t,e){var r=l.get(t);r&&E(r,e)}function d(t){return f.has(t)}function g(t){f.add(t)}function m(t){f.delete(t)}function k(t,e){try{return t.has(e)}catch(t){return!0}}function _(t,e){try{t.add(e)}catch(t){}}function E(t,e){try{t.delete(e)}catch(t){}}var T=/^[$A-Z_][0-9A-Z_$[\].]*$/i,O=function(){function t(e,r){a(this,t),this.path=[],this.prefix="",this.errors=[],this.cyclic=new WeakMap,this.context=e,this.input=r}return i(t,[{key:"inCycle",value:function(t,e){var r=this.cyclic.get(t);return!!r&&k(r,e)}},{key:"startCycle",value:function(t,e){var r=this.cyclic.get(t);r||(r=new WeakSet,this.cyclic.set(t,r)),_(r,e)}},{key:"endCycle",value:function(t,e){var r=this.cyclic.get(t);r&&E(r,e)}},{key:"hasErrors",value:function(t){if(t){var e=!0,r=!1,n=void 0;try{for(var a,i=this.errors[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;if(P(t,c(o,1)[0]))return!0}}catch(t){r=!0,n=t}finally{try{!e&&i.return&&i.return()}finally{if(r)throw n}}return!1}return this.errors.length>0}},{key:"addError",value:function(t,e,r){return this.errors.push([t,r,e]),this}},{key:"clearError",value:function(t){var e=!1;if(t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,u=this.errors[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;P(t,s[0])?e=!0:r.push(s)}}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}this.errors=r}else e=this.errors.length>0,this.errors=[];return e}},{key:"resolvePath",value:function(t){return j(this.input,t)}},{key:"toJSON",value:function(){return y(this)}}]),t}();function S(t){if(!t.length)return"Value";for(var e=t.length,r=new Array(e),n=0;n<e;n++){var a=t[n];"[[Return Type]]"===a?r[n]="Return Type":"string"==typeof a&&T.test(a)?r[n]=n>0?`.${String(a)}`:String(a):r[n]=`[${String(a)}]`}return r.join("")}function j(t,e){for(var r=t,n=e.length,a=0;a<n;a++){if(null==r)return;var i=e[a];"[[Return Type]]"!==i&&(r=r instanceof Map?r.get(i):r[i])}return r}function P(t,e){var r=t.length;if(r>e.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var w=function(t){function e(t,r){a(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name="RuntimeTypeError",Object.assign(n,r),n}return u(e,t),e}(TypeError),N="\n-------------------------------------------------\n\n";function A(t){if(t.hasErrors()){var e=t.prefix,r=t.input,n=t.context,a=t.errors,i=[],o=!0,u=!1,s=void 0;try{for(var p,y=a[Symbol.iterator]();!(o=(p=y.next()).done);o=!0){var l=p.value,f=c(l,3),b=f[0],h=f[1],v=f[2],d=v?v.toString():"*",g=j(r,b),m=n.typeOf(g).toString(),k=S(t.path.concat(b)),_=x(g);"string"==typeof _?i.push(`${k} ${h}\n\nExpected: ${d}\n\nActual Value: ${_}\n\nActual Type: ${m}\n`):i.push(`${k} ${h}\n\nExpected: ${d}\n\nActual: ${m}\n`)}}catch(t){u=!0,s=t}finally{try{!o&&y.return&&y.return()}finally{if(u)throw s}}return new w(e?`${e.trim()} ${i.join(N)}`:i.join(N),{errors:a})}}function x(t){if(null===t)return"null";switch(typeof t){case"string":return`"${t}"`;case"symbol":case"number":case"boolean":case"undefined":return String(t);case"function":return;default:if(Array.isArray(t)||null==t.constructor||t.constructor===Object)try{return JSON.stringify(t,null,2)}catch(t){return}return}}function C(t,e){return A(t.context.validate(t,e))}function R(t,e){var r=void 0;if(t===e)return 0;if((e instanceof V||e instanceof H||e instanceof G||e instanceof ae)&&(e=e.unwrap()),t instanceof V)r=t.compareWith(e);else if(t instanceof K||t instanceof H||e instanceof K)r=t.compareWith(e);else{if(t instanceof $||t instanceof B||t instanceof Dt)return 1;r=t.compareWith(e)}return e instanceof $?1:r}var I=function(){function t(e){a(this,t),this.typeName="Type",this.context=e}return i(t,[{key:"errors",value:function*(t,e,r){}},{key:"accepts",value:function(t){var e=new O(this.context,t),r=!0,n=!1,a=void 0;try{for(var i,o=this.errors(e,[],t)[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){i.value;return!1}}catch(t){n=!0,a=t}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return!0}},{key:"acceptsType",value:function(t){return-1!==R(this,t)}},{key:"compareWith",value:function(t){return-1}},{key:"assert",value:function(t){var e=C(this,t);if(e)throw"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(e,this.assert),e;return t}},{key:"unwrap",value:function(){return this}},{key:"toString",value:function(){return"$Type"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),t}(),$=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="AnyType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){}},{key:"accepts",value:function(t){return!0}},{key:"compareWith",value:function(t){return 1}},{key:"toString",value:function(){return"any"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),M={ERR_CONSTRAINT_VIOLATION:"violated a constraint",ERR_EXPECT_ARRAY:"must be an Array",ERR_EXPECT_TRUE:"must be true",ERR_EXPECT_FALSE:"must be false",ERR_EXPECT_BOOLEAN:"must be true or false",ERR_EXPECT_EMPTY:"must be empty",ERR_EXPECT_EXACT_VALUE:"must be exactly $0",ERR_EXPECT_CALLABLE:"must be callable",ERR_EXPECT_CLASS:"must be a Class of $0",ERR_EXPECT_FUNCTION:"must be a function",ERR_EXPECT_GENERATOR:"must be a generator function",ERR_EXPECT_ITERABLE:"must be iterable",ERR_EXPECT_ARGUMENT:'argument "$0" must be: $1',ERR_EXPECT_RETURN:"expected return type of: $0",ERR_EXPECT_N_ARGUMENTS:"requires $0 argument(s)",ERR_EXPECT_INSTANCEOF:"must be an instance of $0",ERR_EXPECT_KEY_TYPE:"keys must be: $0",ERR_EXPECT_NULL:"must be null",ERR_EXPECT_NUMBER:"must be a number",ERR_EXPECT_OBJECT:"must be an object",ERR_EXPECT_PROMISE:"must be a promise of $0",ERR_EXPECT_STRING:"must be a string",ERR_EXPECT_SYMBOL:"must be a symbol",ERR_EXPECT_THIS:"must be exactly this",ERR_EXPECT_VOID:"must be undefined",ERR_INVALID_DATE:"must be a valid date",ERR_MISSING_PROPERTY:"does not exist on object",ERR_NO_INDEXER:"is not one of the permitted indexer types",ERR_NO_UNION:"must be one of: $0",ERR_UNKNOWN_KEY:'should not contain the key: "$0"'};function z(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var a=M[t];return r.length>0?a.replace(/\$(\d+)/g,(function(t,e){return String(r[e])})):a}var D=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TupleType",n.types=[],s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.types,a=n.length;if(this.context.checkPredicate("Array",r))for(var i=0;i<a;i++)yield*n[i].errors(t,e.concat(i),r[i]);else yield[e,z("ERR_EXPECT_ARRAY"),this]}},{key:"accepts",value:function(t){var e=this.types,r=e.length;if(!this.context.checkPredicate("Array",t)||t.length<r)return!1;for(var n=0;n<r;n++){if(!e[n].accepts(t[n]))return!1}return!0}},{key:"compareWith",value:function(t){if(!(t instanceof e))return-1;var r=this.types,n=t.types;if(n.length<r.length)return-1;for(var a=!1,i=0;i<r.length;i++){var o=R(r[i],n[i]);if(1===o)a=!0;else if(-1===o)return-1}return r.length<n.length?0:a?1:0}},{key:"toString",value:function(){return`[${this.types.join(", ")}]`}},{key:"toJSON",value:function(){return{typeName:this.typeName,types:this.types}}}]),e}(I),W=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ArrayType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){if(this.context.checkPredicate("Array",r)){if(!t.inCycle(this,r)){t.startCycle(this,r);for(var n=this.elementType,a=r.length,i=0;i<a;i++)yield*n.errors(t,e.concat(i),r[i]);t.endCycle(this,r)}}else yield[e,z("ERR_EXPECT_ARRAY"),this]}},{key:"accepts",value:function(t){if(!this.context.checkPredicate("Array",t))return!1;if(b(this,t))return!0;h(this,t);for(var e=this.elementType,r=t.length,n=0;n<r;n++)if(!e.accepts(t[n]))return v(this,t),!1;return v(this,t),!0}},{key:"compareWith",value:function(t){var r=this.elementType;if(t instanceof D){for(var n=t.types,a=0;a<n.length;a++){if(-1===R(r,n[a]))return-1}return 1}return t instanceof e?R(r,t.elementType):-1}},{key:"toString",value:function(){var t=this.elementType;if(d(this))return"string"==typeof t.name?`Array<$Cycle<${t.name}>>`:"Array<$Cycle<Object>>";g(this);var e=`Array<${t.toString()}>`;return m(this),e}},{key:"toJSON",value:function(){return{typeName:this.typeName,elementType:this.elementType}}}]),e}(I),U=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="BooleanLiteralType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){r!==this.value&&(yield[e,z(this.value?"ERR_EXPECT_TRUE":"ERR_EXPECT_FALSE"),this])}},{key:"accepts",value:function(t){return t===this.value}},{key:"compareWith",value:function(t){return t instanceof e&&t.value===this.value?0:-1}},{key:"toString",value:function(){return this.value?"true":"false"}},{key:"toJSON",value:function(){return{type:this.typeName,value:this.value}}}]),e}(I),X=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="BooleanType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){"boolean"!=typeof r&&(yield[e,z("ERR_EXPECT_BOOLEAN"),this])}},{key:"accepts",value:function(t){return"boolean"==typeof t}},{key:"compareWith",value:function(t){return t instanceof U?1:t instanceof e?0:-1}},{key:"toString",value:function(){return"boolean"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),J=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="EmptyType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield[e,z("ERR_EXPECT_EMPTY"),this]}},{key:"accepts",value:function(t){return!1}},{key:"compareWith",value:function(t){return t instanceof e?0:-1}},{key:"toString",value:function(){return"empty"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),B=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ExistentialType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){}},{key:"accepts",value:function(t){return!0}},{key:"compareWith",value:function(t){return 1}},{key:"toString",value:function(){return"*"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),G=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TypeParameterApplication",n.typeInstances=[],s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.parent,a=this.typeInstances;yield*n.errors.apply(n,[t,e,r].concat(p(a)))}},{key:"accepts",value:function(t){var e=this.parent,r=this.typeInstances;return e.accepts.apply(e,[t].concat(p(r)))}},{key:"compareWith",value:function(t){var e;return(e=this.parent).compareWith.apply(e,[t].concat(p(this.typeInstances)))}},{key:"hasProperty",value:function(t){var e,r=this.parent;return!(!r||"function"!=typeof r.hasProperty)&&(e=r).hasProperty.apply(e,[t].concat(p(this.typeInstances)))}},{key:"getProperty",value:function(t){var e,r=this.parent;if(r&&"function"==typeof r.getProperty)return(e=r).getProperty.apply(e,[t].concat(p(this.typeInstances)))}},{key:"unwrap",value:function(){var t;return(t=this.parent).unwrap.apply(t,p(this.typeInstances))}},{key:"toString",value:function(){var t=this.parent,e=this.typeInstances,r=t.name;if(e.length){for(var n=[],a=0;a<e.length;a++){var i=e[a];n.push(i.toString())}return`${r}<${n.join(", ")}>`}return r}},{key:"toJSON",value:function(){return{typeName:this.typeName,typeInstances:this.typeInstances}}}]),e}(I);function L(t){for(var e,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];(e=t.constraints).push.apply(e,p(n))}function*q(t,e,r){for(var n=t.constraints,a=n.length,i=arguments.length,o=Array(i>3?i-3:0),u=3;u<i;u++)o[u-3]=arguments[u];for(var s=0;s<a;s++){var c=n[s],y=c.apply(void 0,p(o));"string"==typeof y&&(yield[r,y,this])}}function F(t){for(var e=t.constraints,r=e.length,n=arguments.length,a=Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];for(var o=0;o<r;o++){var u=e[o];if("string"==typeof u.apply(void 0,p(a)))return!1}return!0}var V=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TypeAlias",n.constraints=[],s(n,r)}return u(e,t),i(e,[{key:"addConstraint",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return L.apply(void 0,[this].concat(p(e))),this}},{key:"errors",value:function*(t,e,r){var n=this.type,a=!1,i=!0,o=!1,u=void 0;try{for(var s,c=n.errors(t,e,r)[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p=s.value;a=!0,yield p}}catch(t){o=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}a||(yield*q(this,t,e,r))}},{key:"accepts",value:function(t){return!!this.type.accepts(t)&&!!F(this,t)}},{key:"compareWith",value:function(t){return t===this?0:this.hasConstraints?-1:R(this.type,t)}},{key:"apply",value:function(){var t=new G(this.context);t.parent=this;for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"unwrap",value:function(){return this.type.unwrap()}},{key:"hasProperty",value:function(t){var e=this.unwrap();return!(!e||"function"!=typeof e.hasProperty)&&e.hasProperty(t)}},{key:"getProperty",value:function(t){var e=this.unwrap();if(e&&"function"==typeof e.getProperty)return e.getProperty(t)}},{key:"toString",value:function(t){var e=this.name,r=this.type;return t?`type ${e} = ${r.toString()};`:e}},{key:"toJSON",value:function(){return{typeName:this.typeName,name:this.name,type:this.type}}},{key:"properties",get:function(){return this.type.properties}},{key:"hasConstraints",get:function(){return this.constraints.length>0}}]),e}(I),Y=Symbol("FlowInto"),H=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TypeParameter",n[Y]=null,s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.bound||this.default,a=this.recorded,i=this.context;if(n instanceof K||n instanceof V)yield*n.errors(t,e,r);else if(a)yield*a.errors(t,e,r);else{if(n){if("AnyType"===n.typeName||"ExistentialType"===n.typeName)return;var o=!1,u=!0,s=!1,c=void 0;try{for(var p,y=n.errors(t,e,r)[Symbol.iterator]();!(u=(p=y.next()).done);u=!0){var l=p.value;o=!0,yield l}}catch(t){s=!0,c=t}finally{try{!u&&y.return&&y.return()}finally{if(s)throw c}}if(o)return}this.recorded=i.typeOf(r)}}},{key:"accepts",value:function(t){var e=this.bound||this.default,r=this.recorded,n=this.context;if(e instanceof K||e instanceof V)return e.accepts(t);if(r)return r.accepts(t);if(e){if("AnyType"===e.typeName||"ExistentialType"===e.typeName)return!0;if(!e.accepts(t))return!1}return this.recorded=n.typeOf(t),!0}},{key:"compareWith",value:function(t){var r=this.bound||this.default,n=this.recorded;return t instanceof e?1:n?R(n,t):r?R(r,t):1}},{key:"unwrap",value:function(){var t=this.bound||this.default,e=this.recorded;return e?e.unwrap():t?t.unwrap():this}},{key:"toString",value:function(t){var e=this.id,r=this.bound,n=this.default;if(t){if(n)return`${e} = ${n.toString()}`;if(r)return`${e}: ${r.toString()}`}return e}},{key:"toJSON",value:function(){return{typeName:this.typeName,id:this.id,bound:this.bound,recorded:this.recorded}}}]),e}(I);var K=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="FlowIntoType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,r,n){var a=this.typeParameter,i=this.context,o=a.recorded,u=a.bound;if(u instanceof e)yield*u.errors(t,r,n);else{if(o){if(!u)return o.accepts(n)?void 0:void(a.recorded=i.union(o,i.typeOf(n)));var s=!1,c=!0,p=!1,y=void 0;try{for(var l,f=u.errors(t,r,n)[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var b=l.value;yield b,s=!0}}catch(t){p=!0,y=t}finally{try{!c&&f.return&&f.return()}finally{if(p)throw y}}if(s)return}else if(u){if("AnyType"===u.typeName||"ExistentialType"===u.typeName)return;var h=!1,v=!0,d=!1,g=void 0;try{for(var m,k=u.errors(t,r,n)[Symbol.iterator]();!(v=(m=k.next()).done);v=!0){var _=m.value;yield _,h=!0}}catch(t){d=!0,g=t}finally{try{!v&&k.return&&k.return()}finally{if(d)throw g}}if(h)return}a.recorded=i.typeOf(n)}}},{key:"accepts",value:function(t){var r=this.typeParameter,n=this.context,a=r.recorded,i=r.bound;if(i instanceof e)return i.accepts(t);if(a)return!(i&&!i.accepts(t))&&(a.accepts(t)||(r.recorded=n.union(a,n.typeOf(t))),!0);if(i){if("AnyType"===i.typeName||"ExistentialType"===i.typeName)return!0;if(!i.accepts(t))return!1}return r.recorded=n.typeOf(t),!0}},{key:"compareWith",value:function(t){var r=this.typeParameter,n=this.context,a=r.recorded,i=r.bound;if(i instanceof e)return i.compareWith(t);if(a)return i&&-1===R(i,t)?-1:0===R(a,t)?0:(r.recorded=n.union(a,t),1);if(i){if("AnyType"===i.typeName||"ExistentialType"===i.typeName)return 1;if(-1===R(i,t))return-1}return r.recorded=t,0}},{key:"unwrap",value:function(){return this.typeParameter.unwrap()}},{key:"toString",value:function(t){return this.typeParameter.toString(t)}},{key:"toJSON",value:function(){return this.typeParameter.toJSON()}}]),e}(I),Q=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="FunctionTypeRestParam",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.type;yield*n.errors(t,e,r)}},{key:"accepts",value:function(t){return this.type.accepts(t)}},{key:"compareWith",value:function(t){return t instanceof Z||t instanceof e?R(this.type,t.type):-1===R(this.type,t)?-1:1}},{key:"toString",value:function(){var t=this.type;return`...${this.name}: ${t.toString()}`}},{key:"toJSON",value:function(){return{typeName:this.typeName,name:this.name,type:this.type}}}]),e}(I),Z=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="FunctionTypeParam",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.optional,a=this.type;n&&void 0===r||(yield*a.errors(t,e,r))}},{key:"accepts",value:function(t){var e=this.optional,r=this.type;return!(!e||void 0!==t)||r.accepts(t)}},{key:"compareWith",value:function(t){return R(this.type,t instanceof e||t instanceof Q?t.type:t)}},{key:"toString",value:function(){var t=this.optional,e=this.type;return`${this.name}${t?"?":""}: ${e.toString()}`}},{key:"toJSON",value:function(){return{typeName:this.typeName,name:this.name,optional:this.optional,type:this.type}}}]),e}(I),tt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="FunctionTypeReturn",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.type;yield*n.errors(t,e.concat("[[Return Type]]"),r)}},{key:"accepts",value:function(t){return this.type.accepts(t)}},{key:"compareWith",value:function(t){return t instanceof e?R(this.type,t.type):-1===R(this.type,t)?-1:1}},{key:"unwrap",value:function(){return this.type}},{key:"toString",value:function(){return this.type.toString()}},{key:"toJSON",value:function(){return{typeName:this.typeName,type:this.type}}}]),e}(I),et=Symbol("Parent"),rt=Symbol("NameRegistry"),nt=Symbol("ModuleRegistry"),at=Symbol("CurrentModule"),it=Symbol("TypeConstructorRegistry"),ot=Symbol("Inferrer"),ut=Symbol("Type"),st=Symbol("TypeParameters"),ct=Symbol("TypePredicateRegistry"),pt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="FunctionType",n.params=[],s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){if("function"==typeof r){var n=r[ut],a=this.returnType,i=this.params;if(n){if(!n.params)return;for(var o=0;o<i.length;o++){var u=i[o],s=n.params[o];(s||u.optional)&&u.acceptsType(s)||(yield[e,z("ERR_EXPECT_ARGUMENT",u.name,u.type.toString()),this])}a.acceptsType(n.returnType)||(yield[e,z("ERR_EXPECT_RETURN",a.toString()),this])}else{for(var c=this.context,p=0;p<i.length;p++){i[p].acceptsType(c.any())}a.acceptsType(c.any())}}else yield[e,z("ERR_EXPECT_FUNCTION"),this]}},{key:"accepts",value:function(t){if("function"!=typeof t)return!1;var e=this.returnType,r=this.params,n=t[ut];if(n){if(!n.params)return!0;for(var a=0;a<r.length;a++){var i=r[a],o=n.params[a];if(!o&&!i.optional)return!1;if(!i.acceptsType(o))return!1}return!!e.acceptsType(n.returnType)}for(var u=this.context,s=0;s<r.length;s++){r[s].acceptsType(u.any())}return e.acceptsType(u.any()),!0}},{key:"compareWith",value:function(t){if(!(t instanceof e))return-1;var r=!1,n=R(this.returnType,t.returnType);if(-1===n)return-1;1===n&&(r=!0);for(var a=this.params,i=t.params,o=0;o<a.length;o++){var u=a[o],s=o>=i.length?t.rest:i[o];if(null==s)return-1;var c=R(u,s);if(-1===c)return-1;1===c&&(r=!0)}return r?1:0}},{key:"acceptsParams",value:function(){for(var t=this.params,e=this.rest,r=t.length,n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];for(var o=a.length,u=0;u<r;u++){var s=t[u];if(u<o){if(!s.accepts(a[u]))return!1}else if(!s.accepts(void 0))return!1}if(o>r&&e)for(var c=r;c<o;c++)if(!e.accepts(a[c]))return!1;return!0}},{key:"acceptsReturn",value:function(t){return this.returnType.accepts(t)}},{key:"assertParams",value:function(){for(var t=this.params,e=this.rest,r=t.length,n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];for(var o=a.length,u=0;u<r;u++){var s=t[u];u<o?s.assert(a[u]):s.assert(void 0)}if(o>r&&e)for(var c=r;c<o;c++)e.assert(a[c]);return a}},{key:"assertReturn",value:function(t){return this.returnType.assert(t),t}},{key:"invoke",value:function(){for(var t=this.params,e=this.rest,r=this.context,n=t.length,a=arguments.length,i=Array(a),o=0;o<a;o++)i[o]=arguments[o];for(var u=i.length,s=0;s<n;s++){var c=t[s];if(s<u){if(!c.acceptsType(i[s]))return r.empty()}else if(!c.accepts(void 0))return r.empty()}if(u>n&&e)for(var p=n;p<u;p++)if(!e.acceptsType(i[p]))return r.empty();return this.returnType.type}},{key:"toString",value:function(){for(var t=this.params,e=this.rest,r=this.returnType,n=[],a=0;a<t.length;a++)n.push(t[a].toString());return e&&n.push(e.toString()),`(${n.join(", ")}) => ${r.toString()}`}},{key:"toJSON",value:function(){return{typeName:this.typeName,params:this.params,rest:this.rest,returnType:this.returnType}}}]),e}(I),yt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="GeneratorType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){r&&"function"==typeof r.next&&"function"==typeof r.return&&"function"==typeof r.throw||(yield[e,z("ERR_EXPECT_GENERATOR"),this])}},{key:"accepts",value:function(t){return t&&"function"==typeof t.next&&"function"==typeof t.return&&"function"==typeof t.throw}},{key:"compareWith",value:function(t){if(!(t instanceof e))return-1===R(this.yieldType,t)?-1:1;var r=!1,n=R(this.yieldType,t.yieldType);return-1===n?-1:(1===n&&(r=!0),-1===(n=R(this.returnType,t.returnType))?-1:(1===n&&(r=!0),-1===(n=R(this.nextType,t.nextType))?-1:(1===n&&(r=!0),r?1:0)))}},{key:"acceptsYield",value:function(t){return this.yieldType.accepts(t)}},{key:"acceptsReturn",value:function(t){return this.returnType.accepts(t)}},{key:"acceptsNext",value:function(t){return this.nextType.accepts(t)}},{key:"assertYield",value:function(t){return this.yieldType.assert(t)}},{key:"assertReturn",value:function(t){return this.returnType.assert(t)}},{key:"assertNext",value:function(t){return this.nextType.assert(t)}},{key:"toString",value:function(){var t=this.yieldType,e=this.returnType,r=this.nextType;return`Generator<${t.toString()}, ${e.toString()}, ${r.toString()}`}},{key:"toJSON",value:function(){return{typeName:this.typeName,yieldType:this.yieldType,returnType:this.returnType,nextType:this.nextType}}}]),e}(I),lt=new WeakSet,ft=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TypeConstructor",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){}},{key:"accepts",value:function(t){var e=this.context,r=this.name;return lt.has(this)||(e.emitWarningMessage(`TypeConstructor ${r} does not implement accepts().`),lt.add(this)),!1}},{key:"compareWith",value:function(t){var e=this.context,r=this.name;return lt.has(this)||(e.emitWarningMessage(`TypeConstructor ${r} does not implement compareWith().`),lt.add(this)),-1}},{key:"inferTypeParameters",value:function(t){return[]}},{key:"apply",value:function(){var t=new G(this.context);t.parent=this;for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"unwrap",value:function(){return this}},{key:"toString",value:function(){return this.name}},{key:"toJSON",value:function(){return{typeName:this.typeName,name:this.name}}}]),e}(I),bt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="GenericType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.name;r instanceof this.impl||(yield[e,z("ERR_EXPECT_INSTANCEOF",n),this])}},{key:"accepts",value:function(t){return t instanceof this.impl}},{key:"compareWith",value:function(t){var r=this.context,n=this.impl,a=r.getAnnotation(n);if(a){for(var i=arguments.length,o=Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];var s=a.unwrap.apply(a,p(o));return R(t,s)}return t instanceof e&&(t.impl===n||n&&n.isPrototypeOf(t.impl))?0:-1}},{key:"unwrap",value:function(){var t=this.context,e=this.impl;if("function"!=typeof e)return this;var r=t.getAnnotation(e);return null!=r?r.unwrap.apply(r,arguments):this}},{key:"inferTypeParameters",value:function(t){return[]}}]),e}(ft);function ht(t,e){if(!t){var r=new Error(e);throw r.name="InvariantViolation","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(r,ht),r}}var vt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="NullLiteralType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){null!==r&&(yield[e,z("ERR_EXPECT_NULL"),this])}},{key:"accepts",value:function(t){return null===t}},{key:"compareWith",value:function(t){return t instanceof e?0:-1}},{key:"toString",value:function(){return"null"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),dt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="VoidType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){void 0!==r&&(yield[e,z("ERR_EXPECT_VOID"),this])}},{key:"accepts",value:function(t){return void 0===t}},{key:"compareWith",value:function(t){return t instanceof e?0:-1}},{key:"toString",value:function(){return"void"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),gt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="NullableType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){null!=r&&(yield*this.type.errors(t,e,r))}},{key:"accepts",value:function(t){return null==t||this.type.accepts(t)}},{key:"compareWith",value:function(t){return t instanceof vt||t instanceof dt?1:t instanceof e?R(this.type,t.type):-1===R(this.type,t)?-1:1}},{key:"unwrap",value:function(){return this}},{key:"toString",value:function(){return`? ${this.type.toString()}`}},{key:"toJSON",value:function(){return{typeName:this.typeName,type:this.type}}}]),e}(I),mt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ObjectTypeProperty",n.static=!1,n.constraints=[],s(n,r)}return u(e,t),i(e,[{key:"addConstraint",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return L.apply(void 0,[this].concat(p(e))),this}},{key:"isNullable",value:function(){return this.value instanceof gt}},{key:"existsOn",value:function(t){return this.key in(this.static?t.constructor:t)==!0}},{key:"errors",value:function*(t,e,r){var n=this.optional,a=this.key,i=this.value,o=void 0,u=void 0;if(this.static){if(null===r||"object"!=typeof r&&"function"!=typeof r)return void(yield[e,z("ERR_EXPECT_OBJECT"),this]);if(u=e.concat("constructor"),"function"!=typeof r.constructor)return void(n||(yield[u,z("ERR_EXPECT_FUNCTION"),this]));u.push(a),o=r.constructor[a]}else o=r[a],u=e.concat(a);if(!n||void 0!==o)if(!this.isNullable()||this.existsOn(r)){var s=!1,c=!0,p=!1,y=void 0;try{for(var l,f=i.errors(t,u,o)[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var b=l.value;s=!0,yield b}}catch(t){p=!0,y=t}finally{try{!c&&f.return&&f.return()}finally{if(p)throw y}}s||(yield*q(this,t,u,o))}else yield[u,z("ERR_MISSING_PROPERTY"),this]}},{key:"accepts",value:function(t){var e=this.optional,r=this.key,n=this.value,a=void 0;if(this.static){if(null===t||"object"!=typeof t&&"function"!=typeof t)return!1;if("function"!=typeof t.constructor)return!!e;a=t.constructor[r]}else a=t[r];return!(!e||void 0!==a)||!(this.isNullable()&&!this.existsOn(t))&&(!!n.accepts(a)&&F(this,a))}},{key:"compareWith",value:function(t){return t instanceof e?t.key!==this.key?-1:R(this.value,t.value):-1}},{key:"unwrap",value:function(){return this.value.unwrap()}},{key:"toString",value:function(){var t=this.key;return"symbol"==typeof t&&(t=`[${t.toString()}]`),this.static?`static ${t}${this.optional?"?":""}: ${this.value.toString()};`:`${t}${this.optional?"?":""}: ${this.value.toString()};`}},{key:"toJSON",value:function(){return{typeName:this.typeName,key:this.key,value:this.value,optional:this.optional}}}]),e}(I),kt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ObjectTypeIndexer",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r,n){"NumberType"!==this.key.typeName&&"NumericLiteralType"!==this.key.typeName||(r=+r),yield*this.key.errors(t,e.concat("[[Key]]"),r),yield*this.value.errors(t,e.concat(r),n)}},{key:"accepts",value:function(t){return this.value.accepts(t)}},{key:"acceptsKey",value:function(t){return"NumberType"!==this.key.typeName&&"NumericLiteralType"!==this.key.typeName||(t=+t),this.key.accepts(t)}},{key:"acceptsValue",value:function(t){return this.value.accepts(t)}},{key:"compareWith",value:function(t){if(t instanceof mt)return this.key.accepts(t.key)?R(this.value,t.value):-1;if(!(t instanceof e))return-1;var r=R(this.key,t.key);if(-1===r)return-1;var n=R(this.value,t.value);return-1===n?-1:0===r&&0===n?0:1}},{key:"unwrap",value:function(){return this.value.unwrap()}},{key:"toString",value:function(){return`[${this.id}: ${this.key.toString()}]: ${this.value.toString()};`}},{key:"toJSON",value:function(){return{typeName:this.typeName,id:this.id,key:this.key,value:this.value}}}]),e}(I),_t=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ObjectTypeCallProperty",n.static=!1,s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.value,a=void 0,i=void 0;if(this.static){if(null===r||"object"!=typeof r&&"function"!=typeof r)return void(yield[e,z("ERR_EXPECT_OBJECT"),this]);if(i=e.concat("constructor"),"function"!=typeof r.constructor)return void(yield[i,z("ERR_EXPECT_FUNCTION"),this]);a=r.constructor}else a=r,i=e;yield*n.errors(t,i,a)}},{key:"accepts",value:function(t){var e=this.value,r=void 0;if(this.static){if(null===t||"object"!=typeof t&&"function"!=typeof t)return!1;if("function"!=typeof t.constructor)return!1;r=t.constructor}else r=t;return e.accepts(r)}},{key:"compareWith",value:function(t){return t instanceof e?R(this.value,t.value):-1}},{key:"unwrap",value:function(){return this.value.unwrap()}},{key:"toString",value:function(){return this.static?`static ${this.value.toString()};`:this.value.toString()}},{key:"toJSON",value:function(){return{typeName:this.typeName,value:this.value}}}]),e}(I),Et=function(t){function e(){return a(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),e}(I),Tt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="VarDeclaration",n.constraints=[],s(n,r)}return u(e,t),i(e,[{key:"addConstraint",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return L.apply(void 0,[this].concat(p(e))),this}},{key:"errors",value:function*(t,e,r){var n=this.type,a=!1,i=!0,o=!1,u=void 0;try{for(var s,c=n.errors(t,e,r)[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p=s.value;a=!0,yield p}}catch(t){o=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}a||(yield*q(this,t,e,r))}},{key:"accepts",value:function(t){return!!this.type.accepts(t)&&!!F(this,t)}},{key:"compareWith",value:function(t){return R(this.type,t)}},{key:"unwrap",value:function(){return this.type.unwrap()}},{key:"toString",value:function(){return`declare var ${this.name}: ${this.type.toString()};`}}]),e}(Et),Ot=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TypeDeclaration",s(n,r)}return u(e,t),i(e,[{key:"addConstraint",value:function(){var t;return(t=this.typeAlias).addConstraint.apply(t,arguments),this}},{key:"errors",value:function*(t,e,r){yield*this.typeAlias.errors(t,e,r)}},{key:"apply",value:function(){var t;return(t=this.typeAlias).apply.apply(t,arguments)}},{key:"accepts",value:function(t){return this.typeAlias.accepts(t)}},{key:"compareWith",value:function(t){return R(this.typeAlias,t)}},{key:"hasProperty",value:function(t){for(var e,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return(e=this.typeAlias).hasProperty.apply(e,[t].concat(p(n)))}},{key:"getProperty",value:function(t){for(var e,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return(e=this.typeAlias).getProperty.apply(e,[t].concat(p(n)))}},{key:"unwrap",value:function(){var t;return(t=this.typeAlias).unwrap.apply(t,arguments)}},{key:"toString",value:function(){return`declare ${this.typeAlias.toString(!0)};`}},{key:"type",get:function(){return this.typeAlias.type}}]),e}(Et),St=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ModuleDeclaration",s(n,r)}return u(e,t),i(e,[{key:"get",value:function(t){var e=this.moduleExports;if(e){var r=e.unwrap();if("function"==typeof r.getProperty){var n=r.getProperty(t);if(n)return n.unwrap()}}else{var a=this.declarations[t];if(a)return a.unwrap()}}},{key:"errors",value:function*(t,e,r){}},{key:"import",value:function(t){return/^\.\//.test(t)&&(t=`${this.name}${t.slice(1)}`),this.innerContext.import(t)}},{key:"toString",value:function(){var t=this.name,e=this.declarations,r=this.modules,n=this.moduleExports,a=[];for(var i in e){var o=e[i];a.push(o.toString(!0))}if(r)for(var u in r){var s=r[u];a.push(s.toString())}return n&&a.push(n.toString()),`declare module "${t}" {\n${function(t){for(var e=t.split("\n"),r=e.length,n=0;n<r;n++)e[n]=`  ${e[n]}`;return e.join("\n")}(a.join("\n\n"))}}`}},{key:"moduleType",get:function(){return this.moduleExports?"commonjs":"es6"}},{key:"isCommonJS",get:function(){return!!this.moduleExports}},{key:"isES6",get:function(){return!this.moduleExports}},{key:"declarations",get:function(){return this.innerContext[rt]}},{key:"modules",get:function(){return this.innerContext[nt]}}]),e}(Et);var jt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ModuleExports",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield*this.type.errors(t,e,r)}},{key:"unwrap",value:function(){return this.type.unwrap()}},{key:"toString",value:function(){return`declare module.exports: ${this.type.toString()};`}}]),e}(Et),Pt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ClassDeclaration",n.shapeID=Symbol(),s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.body,a=this.superClass&&this.superClass.unwrap();if(null===r||"object"!=typeof r&&"function"!=typeof r)yield[e,z("ERR_EXPECT_INSTANCEOF",this.name),this];else{if(a){var i=!0,o=!1,u=void 0;try{for(var s,p=a.errors(t,e,r)[Symbol.iterator]();!(i=(s=p.next()).done);i=!0){var y=s.value,l=c(y,3),f=l[0],b=l[1],h=l[2],v=f[e.length];n.getProperty(v)||(yield[f,b,h])}}catch(t){o=!0,u=t}finally{try{!i&&p.return&&p.return()}finally{if(o)throw u}}}yield*n.errors(t,e,r)}}},{key:"accepts",value:function(t){var e=this.body,r=this.superClass&&this.superClass.unwrap();return null!==t&&("object"==typeof t||"function"==typeof t)&&(!(r&&!r.accepts(t))&&!!e.accepts(t))}},{key:"compareWith",value:function(t){return t instanceof e?t===this?0:this.isSuperClassOf(t)?1:-1:R(this.body,t)}},{key:"getProperty",value:function(t){var e=this.body,r=this.superClass,n=e.getProperty(t);return n||(r&&"function"==typeof r.getProperty?r.getProperty(t):void 0)}},{key:"hasProperty",value:function(t){var e=this.body,r=this.superClass;return!!e.hasProperty(t)||!(!r||"function"!=typeof r.hasProperty)&&r.hasProperty(t)}},{key:"isSuperClassOf",value:function(t){for(var r=this.body,n=this.shapeID,a=t;null!=a;){if(a===this||a===r||a.shapeID===n)return!0;a=a instanceof e?a.superClass:a.unwrap()}return!1}},{key:"apply",value:function(){var t=new G(this.context);t.parent=this;for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"toString",value:function(t){var e=this.name,r=this.superClass,n=this.body;if(t){var a=r&&("string"==typeof r.name&&r.name||r.toString());return`declare class ${e}${a?` extends ${a}`:""} ${n.toString()}`}return e}},{key:"properties",get:function(){var t=this.body,e=this.superClass;if(null==e)return t.properties;var r=t.properties,n=e.unwrap().properties;if(null==n)return r;for(var a={},i={},o=[],u=0;u<n.length;u++){var s=n[u];o.push(s),s.static?i[s.key]=u:a[s.key]=u}for(var c=0;c<r.length;c++){var p=r[c];a[p.key]?o[c]=p:o.push(p)}return o}}]),e}(Et),wt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="PartialType",n.typeParameters=[],s(n,r)}return u(e,t),i(e,[{key:"typeParameter",value:function(t,e,r){var n=new H(this.context);return n.id=t,n.bound=e,n.default=r,this.typeParameters.push(n),n}},{key:"apply",value:function(){var t=new G(this.context);t.parent=this;for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"errors",value:function*(t,e,r){var n=this.constraints,a=this.type,i=!1,o=!0,u=!1,s=void 0;try{for(var c,p=a.errors(t,e,r)[Symbol.iterator]();!(o=(c=p.next()).done);o=!0){var y=c.value;i=!0,yield y}}catch(t){u=!0,s=t}finally{try{!o&&p.return&&p.return()}finally{if(u)throw s}}!i&&n&&(yield*q(this,t,e,r))}},{key:"accepts",value:function(t){var e=this.constraints;return!!this.type.accepts(t)&&!(e&&!F(this,t))}},{key:"compareWith",value:function(t){return t===this?0:R(this.type,t)}},{key:"toString",value:function(t){return this.type.toString(t)}},{key:"unwrap",value:function(){return this.type.unwrap()}},{key:"toJSON",value:function(){return{typeName:this.typeName,typeParameters:this.typeParameters,type:this.type}}}]),e}(I),Nt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ParameterizedClassDeclaration",n.shapeID=Symbol(),s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){for(var n=arguments.length,a=Array(n>3?n-3:0),i=3;i<n;i++)a[i-3]=arguments[i];yield*At.apply(void 0,[this].concat(p(a))).errors(t,e,r)}},{key:"accepts",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return At.apply(void 0,[this].concat(p(r))).accepts(t)}},{key:"compareWith",value:function(t){return At(this).compareWith(t)}},{key:"unwrap",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return At.apply(void 0,[this].concat(p(e))).type}},{key:"isSuperClassOf",value:function(t){return At(this).type.isSuperClassOf(t)}},{key:"apply",value:function(){var t=new G(this.context);t.parent=this;for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"toString",value:function(t){if(!t)return this.name;var e=At(this),r=e.type,n=e.typeParameters;if(0===n.length)return e.toString(!0);for(var a=[],i=0;i<n.length;i++){var o=n[i];a.push(o.toString(!0))}var u=r.superClass,s=r.body,c=u&&("string"==typeof u.name&&u.name||u.toString());return`declare class ${this.name}<${a.join(", ")}>${c?` extends ${c}`:""} ${s.toString()}`}},{key:"toJSON",value:function(){return At(this).toJSON()}},{key:"superClass",get:function(){return At(this).type.superClass}},{key:"body",get:function(){return At(this).type.body}},{key:"properties",get:function(){return At(this).type.properties}},{key:"typeParameters",get:function(){return At(this).typeParameters}}]),e}(Et);function At(t){var e=t.context,r=t.bodyCreator,n=new wt(e),a=r(n);Array.isArray(a)?n.type=e.class.apply(e,[t.name].concat(p(a))):n.type=e.class(t.name,a),n.type.shapeID=t.shapeID;for(var i=n.typeParameters,o=arguments.length,u=Array(o>1?o-1:0),s=1;s<o;s++)u[s-1]=arguments[s];for(var c=Math.min(u.length,i.length),y=0;y<c;y++){var l=i[y],f=u[y];l.bound&&l.bound!==f?l.bound=e.intersect(l.bound,f):l.bound=f}return n}var xt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ExtendsDeclaration",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield*this.type.errors(t,e,r)}},{key:"unwrap",value:function(){return this.type.unwrap()}},{key:"toString",value:function(t){var e=this.type;return t?`extends ${e.toString()}`:e.toString()}}]),e}(Et),Ct=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ObjectType",n.properties=[],n.indexers=[],n.callProperties=[],n.exact=!1,s(n,r)}return u(e,t),i(e,[{key:"getProperty",value:function(t){for(var e=this.properties,r=e.length,n=0;n<r;n++){var a=e[n];if(a.key===t)return a}return this.getIndexer(t)}},{key:"setProperty",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.context,a=this.properties,i=a.length,o=new mt(n);o.key=t,o.value=e,o.optional=r;for(var u=0;u<i;u++){var s=a[u];if(s.key===t)return void(a[u]=o)}a.push(o)}},{key:"hasProperty",value:function(t){for(var e=this.properties,r=e.length,n=0;n<r;n++){if(e[n].key===t)return!0}return this.hasIndexer(t)}},{key:"getIndexer",value:function(t){for(var e=this.indexers,r=e.length,n=0;n<r;n++){var a=e[n];if(a.acceptsKey(t))return a}}},{key:"hasIndexer",value:function(t){for(var e=this.indexers,r=e.length,n=0;n<r;n++){if(e[n].acceptsKey(t))return!0}return!1}},{key:"errors",value:function*(t,e,r){if(null!==r){if(this.callProperties.length>0)Rt(this,r)||(yield[e,z("ERR_EXPECT_CALLABLE"),this]);else if("object"!=typeof r)return void(yield[e,z("ERR_EXPECT_OBJECT"),this]);if(!t.inCycle(this,r)){if(t.startCycle(this,r),this.indexers.length>0){if(r instanceof Object&&Array.isArray(r))return void(yield[e,z("ERR_EXPECT_OBJECT"),this]);yield*function*(t,e,r,n){for(var a=t.properties,i=t.indexers,o=[],u=0;u<a.length;u++){var s=a[u];yield*s.errors(e,r,n),o.push(s.key)}t:for(var c in n)if(-1===o.indexOf(c)){for(var p=n[c],y=0;y<i.length;y++){var l=i[y];if(l.acceptsKey(c)&&l.acceptsValue(p))continue t}yield[r.concat(c),z("ERR_NO_INDEXER"),t]}}(this,t,e,r)}else yield*function*(t,e,r,n){for(var a=t.properties,i=0;i<a.length;i++){var o=a[i];yield*o.errors(e,r,n)}}(this,t,e,r);this.exact&&(yield*function*(t,e,r,n){var a=t.properties,i=function*(e){a.some((function(t){return t.key===e}))||(yield[r,z("ERR_UNKNOWN_KEY",e),t])};for(var o in n)yield*i(o)}(this,0,e,r)),t.endCycle(this,r)}}else yield[e,z("ERR_EXPECT_OBJECT"),this]}},{key:"accepts",value:function(t){if(null===t)return!1;if(this.callProperties.length>0){if(!Rt(this,t))return!1}else if("object"!=typeof t)return!1;if(b(this,t))return!0;h(this,t);var e=void 0;return(e=this.indexers.length>0?function(t,e){for(var r=t.properties,n=t.indexers,a=[],i=0;i<r.length;i++){var o=r[i];if(!o.accepts(e))return!1;a.push(o.key)}t:for(var u in e)if(-1===a.indexOf(u)){for(var s=e[u],c=0;c<n.length;c++){var p=n[c];if(p.acceptsKey(u)&&p.acceptsValue(s))continue t}return!1}return!0}(this,t):function(t,e){for(var r=t.properties,n=0;n<r.length;n++){if(!r[n].accepts(e))return!1}return!0}(this,t))&&this.exact&&(e=function(t,e){var r=t.properties,n=function(t){if(!r.some((function(e){return e.key===t})))return{v:!1}};for(var a in e){var i=n(a);if("object"==typeof i)return i.v}return!0}(this,t)),v(this,t),e}},{key:"compareWith",value:function(t){if(!(t instanceof e||t instanceof Pt||t instanceof Nt))return-1;var r=!1;if(this.callProperties.length>0){var n=function(t,e){var r=t.callProperties,n=e.callProperties,a=0;t:for(var i=0;i<r.length;i++){for(var o=r[i],u=0;u<n.length;u++){var s=n[u],c=R(o,s);if(0===c){a++;continue t}if(1===c)continue t}return-1}return a===r.length?0:1}(this,t);if(-1===n)return-1;1===n&&(r=!0)}var a=void 0;return-1===(a=this.indexers.length>0?function(t,e){var r=t.indexers,n=t.properties,a=e.indexers,i=e.properties,o=!1;t:for(var u=0;u<n.length;u++)for(var s=n[u],c=0;c<i.length;c++){var p=i[c];if(p.key===s.key){var y=R(s,p);if(-1===y)return-1;1===y&&(o=!0);continue t}}t:for(var l=0;l<r.length;l++){for(var f=r[l],b=0;b<a.length;b++){var h=a[b],v=R(f,h);if(1===v){o=!0;continue t}if(0===v)continue t}return-1}return o?1:0}(this,t):function(t,e){var r=t.properties,n=e.properties,a=!1;t:for(var i=0;i<r.length;i++){for(var o=r[i],u=0;u<n.length;u++){var s=n[u];if(s.key===o.key){var c=R(o.value,s.value);if(-1===c)return-1;1===c&&(a=!0);continue t}}return-1}return a?1:0}(this,t))?-1:r?1:a}},{key:"toString",value:function(){var t=this.callProperties,e=this.properties,r=this.indexers;if(d(this))return"$Cycle<Object>";g(this);for(var n=[],a=0;a<t.length;a++)n.push(t[a].toString());for(var i=0;i<e.length;i++)n.push(e[i].toString());for(var o=0;o<r.length;o++)n.push(r[o].toString());return m(this),this.exact?`{|\n${It(n.join("\n"))}\n|}`:`{\n${It(n.join("\n"))}\n}`}},{key:"toJSON",value:function(){return{typeName:this.typeName,callProperties:this.callProperties,properties:this.properties,indexers:this.indexers,exact:this.exact}}}]),e}(I);function Rt(t,e){for(var r=t.callProperties,n=0;n<r.length;n++){if(r[n].accepts(e))return!0}return!1}function It(t){for(var e=t.split("\n"),r=e.length,n=0;n<r;n++)e[n]=`  ${e[n]}`;return e.join("\n")}var $t=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="IntersectionType",n.types=[],s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){for(var n=this.types,a=n.length,i=0;i<a;i++)yield*n[i].errors(t,e,r)}},{key:"getProperty",value:function(t){for(var e=this.types,r=e.length-1;r>=0;r--){var n=e[r];if("function"==typeof n.getProperty){var a=n.getProperty(t);if(a)return a}}}},{key:"hasProperty",value:function(t){for(var e=this.types,r=e.length,n=0;n<r;n++){var a=e[n];if("function"==typeof a.hasProperty&&a.hasProperty(t))return!0}return!1}},{key:"accepts",value:function(t){for(var e=this.types,r=e.length,n=0;n<r;n++){if(!e[n].accepts(t))return!1}return!0}},{key:"compareWith",value:function(t){var r=this.types,n=0;if(t instanceof e){var a=t.types;t:for(var i=0;i<r.length;i++){for(var o=r[i],u=0;u<a.length;u++){var s=R(o,a[i]);if(0===s){n++;continue t}if(1===s)continue t}return-1}return n===r.length?0:1}for(var c=0;c<r.length;c++){var p=R(r[c],t);if(-1===p)return-1;0===p&&n++}return n===r.length?0:1}},{key:"unwrap",value:function(){for(var t,e=[],r=[],n=[],a=this.types,i=this.context,o=0;o<a.length;o++){var u=a[o].unwrap();ht(u instanceof Ct,"Can only intersect object types"),e.push.apply(e,p(u.callProperties)),n.push.apply(n,p(u.indexers)),zt(r,u.properties)}return(t=i).object.apply(t,e.concat(r,n))}},{key:"toString",value:function(){return this.types.join(" & ")}},{key:"toJSON",value:function(){return{typeName:this.typeName,types:this.types}}}]),e}(I);function Mt(t,e){for(var r=0;r<e.length;r++)if(e[r].name===t)return r;return-1}function zt(t,e){for(var r=0;r<e.length;r++){var n=e[r],a=Mt(n.key,t);-1===a?t.push(n):t[a]=n}return t}var Dt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="MixedType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){}},{key:"accepts",value:function(t){return!0}},{key:"toString",value:function(){return"mixed"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),Wt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="NumericLiteralType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.value;r!==n&&(yield[e,z("ERR_EXPECT_EXACT_VALUE",n),this])}},{key:"accepts",value:function(t){return t===this.value}},{key:"compareWith",value:function(t){return t instanceof e&&t.value===this.value?0:-1}},{key:"toString",value:function(){return`${this.value}`}},{key:"toJSON",value:function(){return{typeName:this.typeName,value:this.value}}}]),e}(I),Ut=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="NumberType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){"number"!=typeof r&&(yield[e,z("ERR_EXPECT_NUMBER"),this])}},{key:"accepts",value:function(t){return"number"==typeof t}},{key:"compareWith",value:function(t){return t instanceof e?0:t instanceof Wt?1:-1}},{key:"toString",value:function(){return"number"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),Xt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ParameterizedTypeAlias",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){for(var n=arguments.length,a=Array(n>3?n-3:0),i=3;i<n;i++)a[i-3]=arguments[i];yield*Jt.apply(void 0,[this].concat(p(a))).errors(t,e,r)}},{key:"accepts",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var a=Jt.apply(void 0,[this].concat(p(r)));return!!a.accepts(t)&&!!F(this,t)}},{key:"compareWith",value:function(t){return t===this?0:this.hasConstraints?-1:R(Jt(this),t)}},{key:"hasProperty",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var a=this.unwrap.apply(this,p(r));return!(!a||"function"!=typeof a.hasProperty)&&a.hasProperty.apply(a,[t].concat(p(r)))}},{key:"getProperty",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var a=this.unwrap.apply(this,p(r));if(a&&"function"==typeof a.getProperty)return a.getProperty.apply(a,[t].concat(p(r)))}},{key:"unwrap",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return Jt.apply(void 0,[this].concat(p(e))).unwrap()}},{key:"toString",value:function(t){for(var e=Jt(this),r=e.typeParameters,n=[],a=0;a<r.length;a++){var i=r[a];n.push(i.toString(!0))}var o=this.name,u=r.length>0?`${o}<${n.join(", ")}>`:o;return t?`type ${u} = ${e.toString()};`:u}},{key:"toJSON",value:function(){return Jt(this).toJSON()}},{key:"properties",get:function(){return Jt(this).type.properties}}]),e}(V);function Jt(t){var e=t.typeCreator,r=t.context,n=t.name,a=new wt(r);a.name=n,a.type=e(a),a.constraints=t.constraints;for(var i=a.typeParameters,o=arguments.length,u=Array(o>1?o-1:0),s=1;s<o;s++)u[s-1]=arguments[s];for(var c=Math.min(u.length,i.length),p=0;p<c;p++){var y=i[p],l=u[p];y.bound&&y.bound!==l?y.bound=r.intersect(y.bound,l):y.bound=l}return a}var Bt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ParameterizedFunctionType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){for(var n=arguments.length,a=Array(n>3?n-3:0),i=3;i<n;i++)a[i-3]=arguments[i];yield*Gt.apply(void 0,[this].concat(p(a))).errors(t,e,r)}},{key:"accepts",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return Gt.apply(void 0,[this].concat(p(r))).accepts(t)}},{key:"compareWith",value:function(t){return R(Gt(this),t)}},{key:"acceptsParams",value:function(){var t;return(t=Gt(this).type).acceptsParams.apply(t,arguments)}},{key:"acceptsReturn",value:function(t){return Gt(this).type.acceptsReturn(t)}},{key:"assertParams",value:function(){var t;return(t=Gt(this).type).assertParams.apply(t,arguments)}},{key:"assertReturn",value:function(t){return Gt(this).type.assertReturn(t)}},{key:"unwrap",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return Gt.apply(void 0,[this].concat(p(e))).unwrap()}},{key:"toString",value:function(){var t=Gt(this),e=t.type,r=t.typeParameters;if(0===r.length)return e.toString();for(var n=[],a=0;a<r.length;a++){var i=r[a];n.push(i.toString(!0))}return`<${n.join(", ")}> ${e.toString()}`}},{key:"toJSON",value:function(){return Gt(this).toJSON()}},{key:"typeParameters",get:function(){return Gt(this).typeParameters}},{key:"params",get:function(){return Gt(this).type.params}},{key:"rest",get:function(){return Gt(this).type.rest}},{key:"returnType",get:function(){return Gt(this).type.returnType}}]),e}(I);function Gt(t){var e=t.context,r=t.bodyCreator,n=new wt(e),a=r(n);n.type=e.function.apply(e,p(a));for(var i=n.typeParameters,o=arguments.length,u=Array(o>1?o-1:0),s=1;s<o;s++)u[s-1]=arguments[s];for(var c=Math.min(u.length,i.length),y=0;y<c;y++){var l=i[y],f=u[y];l.bound&&l.bound!==f?l.bound=e.intersect(l.bound,f):l.bound=f}return n}var Lt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="RefinementType",n.constraints=[],s(n,r)}return u(e,t),i(e,[{key:"addConstraint",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return L.apply(void 0,[this].concat(p(e))),this}},{key:"errors",value:function*(t,e,r){var n=this.type,a=!1,i=!0,o=!1,u=void 0;try{for(var s,c=n.errors(t,e,r)[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p=s.value;a=!0,yield p}}catch(t){o=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}a||(yield*q(this,t,e,r))}},{key:"accepts",value:function(t){return!!this.type.accepts(t)&&!!F(this,t)}},{key:"compareWith",value:function(t){return t===this?0:-1}},{key:"apply",value:function(){var t=new G(this.context);t.parent=this;for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"unwrap",value:function(){return this.type.unwrap()}},{key:"hasProperty",value:function(t){var e=this.unwrap();return!(!e||"function"!=typeof e.hasProperty)&&e.hasProperty(t)}},{key:"getProperty",value:function(t){var e=this.unwrap();if(e&&"function"==typeof e.getProperty)return e.getProperty(t)}},{key:"toString",value:function(){return`$Refinment<${this.type.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,type:this.type}}}]),e}(I),qt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="StringLiteralType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){r!==this.value&&(yield[e,z("ERR_EXPECT_EXACT_VALUE",this.toString()),this])}},{key:"accepts",value:function(t){return t===this.value}},{key:"compareWith",value:function(t){return t instanceof e&&t.value===this.value?0:-1}},{key:"toString",value:function(){return JSON.stringify(this.value)}},{key:"toJSON",value:function(){return{typeName:this.typeName,value:this.value}}}]),e}(I),Ft=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="StringType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){"string"!=typeof r&&(yield[e,z("ERR_EXPECT_STRING"),this])}},{key:"accepts",value:function(t){return"string"==typeof t}},{key:"compareWith",value:function(t){return t instanceof qt?1:t instanceof e?0:-1}},{key:"toString",value:function(){return"string"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),Vt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="SymbolLiteralType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){r!==this.value&&(yield[e,z("ERR_EXPECT_EXACT_VALUE",this.toString()),this])}},{key:"accepts",value:function(t){return t===this.value}},{key:"compareWith",value:function(t){return t instanceof e&&t.value===this.value?0:-1}},{key:"toString",value:function(){return`typeof ${String(this.value)}`}},{key:"toJSON",value:function(){return{typeName:this.typeName,value:this.value}}}]),e}(I),Yt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="SymbolType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){"symbol"!=typeof r&&(yield[e,z("ERR_EXPECT_SYMBOL"),this])}},{key:"accepts",value:function(t){return"symbol"==typeof t}},{key:"compareWith",value:function(t){return t instanceof Vt?1:t instanceof e?0:-1}},{key:"toString",value:function(){return"Symbol"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),Ht=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ThisType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.recorded;r!==n&&("function"==typeof n&&r instanceof n||null!=n&&(yield[e,z("ERR_EXPECT_THIS"),this]))}},{key:"accepts",value:function(t){var e=this.recorded;return t===e||("function"==typeof e&&t instanceof e||null==e)}},{key:"compareWith",value:function(t){return t instanceof e?t.recorded&&this.recorded?t.recorded===this.recorded?0:-1:this.recorded?0:1:-1}},{key:"unwrap",value:function(){return this}},{key:"toString",value:function(t){return"this"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),Kt=new WeakSet,Qt=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TypeBox",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield*this.type.errors(t,e,r)}},{key:"accepts",value:function(t){return this.type.accepts(t)}},{key:"compareWith",value:function(t){return R(this.type,t)}},{key:"apply",value:function(){var t=new G(this.context);t.parent=this.type;for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"unwrap",value:function(){return this.type.unwrap()}},{key:"toString",value:function(){return this.type.toString()}},{key:"toJSON",value:function(){return this.type.toJSON()}},{key:"name",get:function(){return this.type.name}},{key:"type",get:function(){var t=(0,this.reveal)();return t?t instanceof I?t:this.context.ref(t):(Kt.has(this)||(this.context.emitWarningMessage("Failed to reveal boxed type."),Kt.add(this)),this.context.mixed())}}]),e}(I),Zt={},te=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TypeReference",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield*this.type.errors(t,e,r)}},{key:"accepts",value:function(t){return this.type.accepts(t)}},{key:"compareWith",value:function(t){return R(this.type,t)}},{key:"apply",value:function(){var t=new G(this.context);t.parent=this;for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"unwrap",value:function(){return this.type.unwrap()}},{key:"toString",value:function(){return this.name}},{key:"toJSON",value:function(){return{typeName:this.typeName,name:this.name}}},{key:"type",get:function(){var t=this.context,e=this.name,r=t.get(e);return r||(Zt[e]||(t.emitWarningMessage(`Cannot resolve type: ${e}`),Zt[e]=!0),t.any())}}]),e}(I),ee=new WeakSet,re=Symbol("RevealedName"),ne=Symbol("RevealedValue"),ae=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="TypeTDZ",n[re]=void 0,n[ne]=void 0,s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield*ie(this).errors(t,e,r)}},{key:"accepts",value:function(t){return ie(this).accepts(t)}},{key:"compareWith",value:function(t){return R(ie(this),t)}},{key:"apply",value:function(){var t=new G(this.context);t.parent=ie(this);for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.typeInstances=r,t}},{key:"unwrap",value:function(){return ie(this).unwrap()}},{key:"hasProperty",value:function(t){var e=this.unwrap();return!(!e||"function"!=typeof e.hasProperty)&&e.hasProperty(t)}},{key:"getProperty",value:function(t){var e=this.unwrap();if(e&&"function"==typeof e.getProperty)return e.getProperty(t)}},{key:"toString",value:function(){return ie(this).toString()}},{key:"toJSON",value:function(){return ie(this).toJSON()}},{key:"name",get:function(){var t=this[re];return t||(t=ie(this).name),t},set:function(t){this[re]=t}}]),e}(I);function ie(t){var e=t[ne];if(e)return e;var r=(0,t.reveal)();if(!r){if(!ee.has(t)){var n=t[re];n?t.context.emitWarningMessage(`Failed to reveal type called "${n}" in Temporal Dead Zone.`):t.context.emitWarningMessage("Failed to reveal unknown type in Temporal Dead Zone."),ee.add(t)}return t.context.mixed()}return r instanceof I?r:t.context.ref(r)}var oe=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="UnionType",n.types=[],s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){for(var n=this.types,a=n.length,i=0;i<a;i++){if(n[i].accepts(r))return}yield[e,z("ERR_NO_UNION",this.toString()),this]}},{key:"accepts",value:function(t){for(var e=this.types,r=e.length,n=0;n<r;n++){if(e[n].accepts(t))return!0}return!1}},{key:"compareWith",value:function(t){var r=this.types;if(t instanceof e){var n=t.types,a=0;t:for(var i=0;i<r.length;i++){for(var o=r[i],u=0;u<n.length;u++){var s=R(o,n[i]);if(0===s){a++;continue t}if(1===s)continue t}return-1}return a===r.length?0:1}for(var c=0;c<r.length;c++){if(R(r[c],t)>=0)return 1}return-1}},{key:"toString",value:function(){for(var t=this.types,e=new Array(t.length),r=0;r<t.length;r++){var n=t[r];"FunctionType"===n.typeName||"ParameterizedFunctionType"===n.typeName?e[r]=`(${n.toString()})`:e[r]=n.toString()}return e.join(" | ")}},{key:"toJSON",value:function(){return{typeName:this.typeName,types:this.types}}}]),e}(I);var ue=function(){function t(e){a(this,t),this.context=e}return i(t,[{key:"infer",value:function(t){var e=this.inferPrimitive(t);if(e)return e;var r=new Map;return this.inferComplex(t,r)}},{key:"inferInternal",value:function(t,e){var r=this.inferPrimitive(t);return r||this.inferComplex(t,e)}},{key:"inferPrimitive",value:function(t){var e=this.context;return null===t?e.null():void 0===t?e.void():"number"==typeof t?e.number():"boolean"==typeof t?e.boolean():"string"==typeof t?e.string():"symbol"==typeof t?e.symbol(t):void 0}},{key:"inferComplex",value:function(t,e){var r=this.context;return"function"==typeof t?this.inferFunction(t,e):null!==t&&"object"==typeof t?this.inferObject(t,e):r.any()}},{key:"inferFunction",value:function(t,e){for(var r=this.context,n=t.length,a=new Array(n+1),i=0;i<n;i++)a[i]=r.param(String.fromCharCode(97+i),r.existential());return a[n]=r.return(r.existential()),r.fn.apply(r,a)}},{key:"inferObject",value:function(t,e){var r=e.get(t);if(r)return r;var n=this.context,a=void 0,i=n.box((function(){return a}));if(e.set(t,i),n.checkPredicate("Array",t))a=this.inferArray(t,e);else if(t instanceof Object)if(t.constructor!==Object){var o=n.getTypeConstructor(t.constructor);if(o){var u=o.inferTypeParameters(t);a=o.apply.apply(o,p(u))}else a=n.ref(t.constructor)}else{var s=[];for(var c in t){var y=t[c];s.push(n.property(c,this.inferInternal(y,e)))}a=n.object.apply(n,s)}else a=this.inferDict(t,e);return e.set(t,a),a}},{key:"inferDict",value:function(t,e){var r=[],n=[];t:for(var a in t){for(var i=t[a],o=isNaN(+a)?n:r,u=0;u<o.length;u++){if(o[u].accepts(i))continue t}o.push(this.inferInternal(i,e))}var s=this.context,c=[];return 1===r.length?c.push(s.indexer("index",s.number(),r[0])):r.length>1&&c.push(s.indexer("index",s.number(),s.union.apply(s,r))),1===n.length?c.push(s.indexer("key",s.string(),n[0])):n.length>1&&c.push(s.indexer("key",s.string(),s.union.apply(s,n))),s.object.apply(s,c)}},{key:"inferArray",value:function(t,e){var r=this.context,n=[],a=[],i=t.length;t:for(var o=0;o<i;o++){for(var u=t[o],s=this.inferInternal(u,e),c=0;c<n.length;c++){if(n[c].accepts(u)&&s.accepts(a[c]))continue t}n.push(s),a.push(u)}return 0===n.length?r.array(r.any()):1===n.length?r.array(n[0]):r.array(r.union.apply(r,n))}}]),t}();function se(t){if(t.hasErrors()){var e=t.input,r=t.context,n=[],a=!0,i=!1,o=void 0;try{for(var u,s=t.errors[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var p=u.value,y=c(p,3),l=y[0],f=y[1],b=y[2],h=b?b.toString():"*",v=r.typeOf(j(e,l)).toString(),d=S(t.path.concat(l));n.push(`${d} ${f}\n\nExpected: ${h}\n\nActual: ${v}\n`)}}catch(t){i=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}return`Warning: ${n.join("\n-------------------------------------------------\n\n")}`}}function ce(t,e){for(var r=e.length,n=[],a=0;a<r;a++){var i=e[a];if(i instanceof $||i instanceof Dt||i instanceof B)return i;i instanceof oe?pe(n,i.types):n.push(i)}var o=new oe(t);return o.types=n,o}function pe(t,e){t:for(var r=0;r<e.length;r++){for(var n=e[r],a=0;a<t.length;a++){if(-1!==R(t[a],n))continue t}t.push(n)}}function ye(t,e,r,n,a){return"function"==typeof n.get&&"function"==typeof n.set?function(t,e,r,n,a){var i=[le(e),r],o=n.set;n.set=function(e){var r=fe(this,t),n=r.context;a?n.assert(r,e,"Property",i):n.warn(r,e,"Property",i),o.call(this,e)}}(t,e,r,n,a):function(t,e,r,n,a){var i=(y=r,`_flowRuntime$${y}`),u=le(e),s=n.initializer,c=(n.writable,function(t,e){var r={};for(var n in t)e.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r}(n,["initializer","writable"])),p=[u,r];var y;return o({},c,{type:"accessor",get(){if(i in this)return this[i];if(s){var e=fe(this,t),r=s.call(this);return e.context.check(e,r,"Default value for property",p),Object.defineProperty(this,i,{writable:!0,value:r}),r}Object.defineProperty(this,i,{writable:!0,value:void 0})},set(e){var r=fe(this,t),n=r.context;a?n.assert(r,e,"Property",p):n.warn(r,e,"Property",p),i in this?this[i]=e:Object.defineProperty(this,i,{writable:!0,value:e})}})}(t,e,r,n,a)}function le(t){return"function"==typeof t?t.name||"[Class anonymous]":"function"==typeof t.constructor?le(t.constructor):"[Class anonymous]"}function fe(t,e){return"function"==typeof e?e.call(t):e}function be(t,e){if(e instanceof I)return t[ut]=e,t;var r=t;return function(t){return t[ut]=r,t}}var he=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$DiffType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.aType,a=this.bType;if(null===r||"object"!=typeof r&&"function"!=typeof r)yield[e,z("ERR_EXPECT_OBJECT"),this];else{n=n.unwrap(),a=a.unwrap(),ht(n instanceof Ct&&a instanceof Ct,"Can only $Diff object types.");for(var i=n.properties,o=0;o<i.length;o++){var u=i[o];a.hasProperty(u.key)||(yield*u.errors(t,e.concat(u.key),r))}}}},{key:"accepts",value:function(t){var e=this.aType,r=this.bType;if(null===t||"object"!=typeof t&&"function"!=typeof t)return!1;e=e.unwrap(),r=r.unwrap(),ht(e instanceof Ct&&r instanceof Ct,"Can only $Diff object types.");for(var n=e.properties,a=0;a<n.length;a++){var i=n[a];if(!r.hasProperty(i.key)&&!i.accepts(t))return!1}return!0}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){var t,e=this.aType,r=this.bType;e=e.unwrap(),r=r.unwrap(),ht(e instanceof Ct&&r instanceof Ct,"Can only $Diff object types.");for(var n=e.properties,a=[],i=0;i<n.length;i++){var o=n[i];r.hasProperty(o.key)||a.push(o)}return(t=this.context).object.apply(t,a)}},{key:"toString",value:function(){return`$Diff<${this.aType.toString()}, ${this.bType.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,aType:this.aType,bType:this.bType}}}]),e}(I),ve=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$FlowFixMeType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}},{key:"accepts",value:function(t){return!0}},{key:"compareWith",value:function(t){return 1}},{key:"unwrap",value:function(){return this}},{key:"toString",value:function(){return"$FlowFixMe"}},{key:"toJSON",value:function(){return{typeName:this.typeName}}}]),e}(I),de=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$KeysType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.type.unwrap();ht(n instanceof Ct,"Can only $Keys<T> object types.");for(var a=n.properties,i=a.length,o=0;o<i;o++){if(r===a[o].key)return}for(var u=new Array(i),s=0;s<i;s++)u[s]=a[s].key;yield[e,z("ERR_NO_UNION",u.join(" | ")),this]}},{key:"accepts",value:function(t){var e=this.type.unwrap();ht(e instanceof Ct,"Can only $Keys<T> object types.");for(var r=e.properties,n=r.length,a=0;a<n;a++){if(t===r[a].key)return!0}return!1}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){var t,e=this.context,r=this.type.unwrap();ht(r instanceof Ct,"Can only $Keys<T> object types.");for(var n=r.properties,a=n.length,i=new Array(a),o=0;o<a;o++){var u=n[o];i[o]=e.literal(u.key)}return(t=this.context).union.apply(t,i)}},{key:"toString",value:function(){return`$Keys<${this.type.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,type:this.type}}}]),e}(I),ge=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$ObjMapiType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.object,a=this.mapper,i=this.context,o=n.unwrap();if(ht(o instanceof Ct,"Target must be an object type."),null===r||"object"!=typeof r&&"function"!=typeof r)yield[e,z("ERR_EXPECT_OBJECT"),this];else{var u=!0,s=!1,c=void 0;try{for(var p,y=o.properties[Symbol.iterator]();!(u=(p=y.next()).done);u=!0){var l=p.value,f=a.unwrap();ht(f instanceof pt,"Mapper must be a function type.");var b=f.invoke(i.literal(l.key),l.value),h=r[l.key];yield*b.errors(t,e.concat(l.key),h)}}catch(t){s=!0,c=t}finally{try{!u&&y.return&&y.return()}finally{if(s)throw c}}}}},{key:"accepts",value:function(t){var e=this.object,r=this.mapper,n=this.context,a=e.unwrap();if(ht(a instanceof Ct,"Target must be an object type."),null===t||"object"!=typeof t&&"function"!=typeof t)return!1;var i=!0,o=!1,u=void 0;try{for(var s,c=a.properties[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p=s.value,y=r.unwrap();ht(y instanceof pt,"Mapper must be a function type.");var l=y.invoke(n.literal(p.key),p.value),f=t[p.key];if(!l.accepts(f))return!1}}catch(t){o=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}return!0}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){var t=this.object,e=this.mapper,r=this.context,n=t.unwrap();ht(n instanceof Ct,"Target must be an object type.");var a=[],i=!0,o=!1,u=void 0;try{for(var s,c=n.properties[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p=s.value,y=e.unwrap();ht(y instanceof pt,"Mapper must be a function type."),a.push(r.property(p.key,y.invoke(r.literal(p.key),p.value)))}}catch(t){o=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}return r.object.apply(r,a)}},{key:"toString",value:function(){return`$ObjMapi<${this.object.toString()}, ${this.mapper.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,object:this.object,mapper:this.mapper}}}]),e}(I),me=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$ObjMapType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.object,a=this.mapper,i=this.context,o=n.unwrap();if(ht(o instanceof Ct,"Target must be an object type."),null===r||"object"!=typeof r&&"function"!=typeof r)yield[e,z("ERR_EXPECT_OBJECT"),this];else{var u=!0,s=!1,c=void 0;try{for(var p,y=o.properties[Symbol.iterator]();!(u=(p=y.next()).done);u=!0){var l=p.value,f=a.unwrap();ht(f instanceof pt,"Mapper must be a function type.");var b=f.invoke(i.literal(l.key)),h=r[l.key];yield*b.errors(t,e.concat(l.key),h)}}catch(t){s=!0,c=t}finally{try{!u&&y.return&&y.return()}finally{if(s)throw c}}}}},{key:"accepts",value:function(t){var e=this.object,r=this.mapper,n=this.context,a=e.unwrap();if(ht(a instanceof Ct,"Target must be an object type."),null===t||"object"!=typeof t&&"function"!=typeof t)return!1;var i=!0,o=!1,u=void 0;try{for(var s,c=a.properties[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p=s.value,y=r.unwrap();ht(y instanceof pt,"Mapper must be a function type.");var l=y.invoke(n.literal(p.key)),f=t[p.key];if(!l.accepts(f))return!1}}catch(t){o=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}return!0}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){var t=this.object,e=this.mapper,r=this.context,n=t.unwrap();ht(n instanceof Ct,"Target must be an object type.");var a=[],i=!0,o=!1,u=void 0;try{for(var s,c=n.properties[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p=s.value,y=e.unwrap();ht(y instanceof pt,"Mapper must be a function type."),a.push(r.property(p.key,y.invoke(r.literal(p.key))))}}catch(t){o=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}return r.object.apply(r,a)}},{key:"toString",value:function(){return`$ObjMap<${this.object.toString()}, ${this.mapper.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,object:this.object,mapper:this.mapper}}}]),e}(I),ke=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$PropertyType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield*this.unwrap().errors(t,e,r)}},{key:"accepts",value:function(t){return this.unwrap().accepts(t)}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){var t=this.object,e=this.property,r=t.unwrap();return ht("function"==typeof r.getProperty,"Can only use $PropertyType on Objects."),r.getProperty(e).unwrap()}},{key:"toString",value:function(){return`$PropertyType<${this.object.toString()}, ${String(this.property)}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,object:this.object,property:this.property}}}]),e}(I),_e=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$ShapeType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.type;if(null===r||"object"!=typeof r&&"function"!=typeof r)yield[e,z("ERR_EXPECT_OBJECT"),this];else for(var a in ht("function"==typeof(n=n.unwrap()).getProperty,"Can only $Shape<T> object types."),r){var i=n.getProperty(a);i&&(yield*i.errors(t,e,r))}}},{key:"accepts",value:function(t){var e=this.type;if(null===t||"object"!=typeof t&&"function"!=typeof t)return!1;for(var r in ht("function"==typeof(e=e.unwrap()).getProperty,"Can only $Shape<T> object types."),t){var n=e.getProperty(r);if(!n||!n.accepts(t))return!1}return!0}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){var t,e=this.type;e=e.unwrap();var r=this.context;ht(e instanceof Ct,"Can only $Shape<T> object types.");for(var n=e.properties,a=new Array(n.length),i=0;i<n.length;i++){var o=n[i];a[i]=r.property(o.key,o.value,!0)}return(t=this.context).object.apply(t,a)}},{key:"toString",value:function(){return`$Shape<${this.type.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,type:this.type}}}]),e}(I),Ee=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$SubType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield*this.type.errors(r,e)}},{key:"accepts",value:function(t){return this.type.accepts(t)}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){return this.type}},{key:"toString",value:function(){return`$Subtype<${this.type.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,type:this.type}}}]),e}(I),Te=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$SuperType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){yield*this.type.errors(t,e,r)}},{key:"accepts",value:function(t){return this.type.accepts(t)}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){return this.type}},{key:"toString",value:function(){return`$Supertype<${this.type.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,type:this.type}}}]),e}(I),Oe=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$TupleMapType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.tuple,a=this.mapper,i=this.context,o=n.unwrap();if(ht(o instanceof D,"Target must be a tuple type."),i.checkPredicate("Array",r))for(var u=0;u<o.types.length;u++){var s=o.types[u],c=a.unwrap();ht(c instanceof pt,"Mapper must be a function type.");var p=c.invoke(s),y=r[u];yield*p.errors(t,e.concat(u),y)}else yield[e,z("ERR_EXPECT_ARRAY"),this]}},{key:"accepts",value:function(t){var e=this.tuple,r=this.mapper,n=this.context,a=e.unwrap();if(ht(a instanceof D,"Target must be a tuple type."),!n.checkPredicate("Array",t))return!1;for(var i=0;i<a.types.length;i++){var o=a.types[i],u=r.unwrap();if(ht(u instanceof pt,"Mapper must be a function type."),!u.invoke(o).accepts(t[i]))return!1}return!0}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){var t=this.tuple,e=this.mapper,r=this.context,n=t.unwrap();ht(n instanceof D,"Target must be an tuple type.");for(var a=[],i=0;i<n.types.length;i++){var o=n.types[i],u=e.unwrap();ht(u instanceof pt,"Mapper must be a function type."),a.push(u.invoke(o).unwrap().unwrap())}return r.tuple.apply(r,a)}},{key:"toString",value:function(){return`$TupleMap<${this.tuple.toString()}, ${this.mapper.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,tuple:this.tuple,mapper:this.mapper}}}]),e}(I),Se=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="$ValuesType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.type.unwrap();ht(n instanceof Ct,"Can only $Values<T> object types.");for(var a=n.properties,i=a.length,o=0;o<i;o++){if(a[o].value.accepts(r))return}for(var u=new Array(i),s=0;s<i;s++)u[s]=a[s].value.toString();yield[e,z("ERR_NO_UNION",u.join(" | ")),this]}},{key:"accepts",value:function(t){var e=this.type.unwrap();ht(e instanceof Ct,"Can only $Values<T> object types.");for(var r=e.properties,n=r.length,a=0;a<n;a++){if(r[a].value.accepts(t))return!0}return!1}},{key:"compareWith",value:function(t){return R(this.unwrap(),t)}},{key:"unwrap",value:function(){var t=this.context,e=this.type.unwrap();ht(e instanceof Ct,"Can only $Values<T> object types.");for(var r=e.properties,n=r.length,a=new Array(n),i=0;i<n;i++){var o=r[i];a[i]=o.value}return t.union.apply(t,a)}},{key:"toString",value:function(){return`$Values<${this.type.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,type:this.type}}}]),e}(I);function je(t,e,r){var n=e.impl;if("function"!=typeof n)return!0;if(n===r||n.isPrototypeOf(r))return!0;var a=t.getAnnotation(n);return null!=a&&Pe(t,a,r)}function Pe(t,e,r){var n=t.getAnnotation(r);return null==n||-1!==R(e,n)}var we,Ne,Ae=function(t){function e(){var t,r,n;a(this,e);for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];return r=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.typeName="ClassType",s(n,r)}return u(e,t),i(e,[{key:"errors",value:function*(t,e,r){var n=this.instanceType,a=this.context;if("function"==typeof r){var i="ClassDeclaration"===n.typeName?n:n.unwrap();(i instanceof bt?je(a,i,r):Pe(a,i,r))||(yield[e,z("ERR_EXPECT_CLASS",n.toString()),this])}else yield[e,z("ERR_EXPECT_CLASS",n.toString()),this]}},{key:"accepts",value:function(t){var e=this.instanceType,r=this.context;if("function"!=typeof t)return!1;var n="ClassDeclaration"===e.typeName?e:e.unwrap();return n instanceof bt?je(r,n,t):Pe(r,n,t)}},{key:"compareWith",value:function(t){var r=this.instanceType;return t instanceof e?R(r,t.instanceType):-1}},{key:"toString",value:function(){return`Class<${this.instanceType.toString()}>`}},{key:"toJSON",value:function(){return{typeName:this.typeName,instanceType:this.instanceType}}}]),e}(I),xe=new WeakSet,Ce=function(){function t(){a(this,t),this.mode="assert",this[rt]={},this[ct]={},this[it]=new Map,this[ot]=new ue(this),this[nt]={}}return i(t,[{key:"makeJSONError",value:function(t){return y(t)}},{key:"makeTypeError",value:function(t){return A(t)}},{key:"createContext",value:function(){var e=new t;return e[et]=this,e}},{key:"typeOf",value:function(t){var e=this.getAnnotation(t);if(e)return"function"==typeof t&&(e instanceof Pt||e instanceof Nt)?this.Class(e):e;var r=this[ot];return r.infer(t)}},{key:"compareTypes",value:function(t,e){return R(t,e)}},{key:"get",value:function(t){for(var e=this[rt][t],r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];if(null!=e){for(var i="function"==typeof e?new e(this):e,o=0;o<n.length;o++){var u=n[o];if("function"!=typeof i.getProperty)return;if(!(i=i.getProperty(u)))return;i=i.unwrap()}return i}var s=this[et];if(s){var c=s.get.apply(s,[t].concat(p(n)));if(c)return c}if("function"==typeof global[t]){var y=new bt(this);return y.name=t,y.impl=global[t],this[rt][t]=y,y}}},{key:"getPredicate",value:function(t){var e=this[ct][t];if(e)return e;var r=this[et];return r?r.getPredicate(t):void 0}},{key:"setPredicate",value:function(t,e){this[ct][t]=e}},{key:"checkPredicate",value:function(t,e){var r=this.getPredicate(t);return!!r&&r(e)}},{key:"decorate",value:function(t,e){var r=this;return null==e&&(e="assert"===this.mode),function(n,a,i){return i&&"string"==typeof a?ye(t,n,a,i,Boolean(e)):(ht("function"!=typeof t,"Cannot decorate an object or function as a method."),r.annotate(n,t))}}},{key:"annotate",value:function(t,e){return void 0===e?be(t):be(t,e)}},{key:"getAnnotation",value:function(t){if(null!==t&&"object"==typeof t||"function"==typeof t)return t[ut]}},{key:"hasAnnotation",value:function(t){return null!=t&&!!t[ut]}},{key:"setAnnotation",value:function(t,e){return t[ut]=e,t}},{key:"type",value:function(t,e){if("function"==typeof e){var r=new Xt(this);return r.name=t,r.typeCreator=e,r}var n=new V(this);return n.name=t,n.type=e,n}},{key:"declare",value:function(t,e){if((t instanceof Et||t instanceof V)&&(t=(e=t).name),"function"==typeof e&&(e=this.type(t,e)),e instanceof St)return this[nt][t]=e,e;ht("string"==typeof t,"Name must be a string"),ht(e instanceof I,"Type must be supplied to declaration");var r=this[rt];if(e instanceof Et)return r[t]=e,e;if(e instanceof V||e instanceof Xt){var n=new Ot(this);return n.name=t,n.typeAlias=e,r[t]=n,n}var a=this.var(t,e);return r[t]=a,a}},{key:"declarations",value:function*(){var t=this[rt];for(var e in t)yield[e,t[e]]}},{key:"modules",value:function*(){var t=this[nt];for(var e in t)yield t[e]}},{key:"import",value:function(t){var e=this[nt];if(e[t])return e[t];var r=t.split("/"),n=e[c(r,1)[0]];if(n)return n.import(t);var a=this[et];return a?a.import(t):void 0}},{key:"declareTypeConstructor",value:function(t){var e=t.name,r=t.impl,n=t.typeName,a=t.errors,i=t.accepts,o=t.inferTypeParameters,u=t.compareWith,s=this[rt];s[e]&&this.emitWarningMessage(`Redeclaring type: ${e}, this may be unintended.`);var c=new ft(this);if(c.name=e,c.typeName=n,c.impl=r,c.errors=a,c.accepts=i,c.inferTypeParameters=o,"function"==typeof u&&(c.compareWith=u),s[e]=c,"function"==typeof r){var p=this[it];p.has(r)&&this.emitWarningMessage(`A type handler already exists for the given implementation of ${e}.`),p.set(r,c)}return c}},{key:"getTypeConstructor",value:function(t){var e=this[it];return e.get(t)}},{key:"literal",value:function(t){return void 0===t?this.void():null===t?this.null():"boolean"==typeof t?this.boolean(t):"number"==typeof t?this.number(t):"string"==typeof t?this.string(t):"symbol"==typeof t?this.symbol(t):this.typeOf(t)}},{key:"null",value:function(){return n.null}},{key:"nullable",value:function(t){var e=new gt(this);return e.type=t,e}},{key:"existential",value:function(){return n.existential}},{key:"empty",value:function(){return n.empty}},{key:"any",value:function(){return n.any}},{key:"mixed",value:function(){return n.mixed}},{key:"void",value:function(){return n.void}},{key:"this",value:function(t){var e=new Ht(this);return void 0!==t&&(e.recorded=t),e}},{key:"number",value:function(t){if(void 0!==t){var e=new Wt(this);return e.value=t,e}return n.number}},{key:"boolean",value:function(t){if(void 0!==t){var e=new U(this);return e.value=t,e}return n.boolean}},{key:"string",value:function(t){if(void 0!==t){var e=new qt(this);return e.value=t,e}return n.string}},{key:"symbol",value:function(t){if(void 0!==t){var e=new Vt(this);return e.value=t,e}return n.symbol}},{key:"typeParameter",value:function(t,e,r){var n=new H(this);return n.id=t,n.bound=e,n.default=r,n}},{key:"flowInto",value:function(t){return function(t){var e=t[Y];if(e)return e;var r=new K(t.context);return r.typeParameter=t,t[Y]=r,r}(t)}},{key:"bindTypeParameters",value:function(t){var e=Object.getPrototypeOf(t),r=e&&Object.getPrototypeOf(e),n=r&&r.constructor;if(!n)return this.emitWarningMessage("Could not bind type parameters for non-existent parent class."),t;var a=n[st];if(a){for(var i=t[a],o=Object.keys(i),u=arguments.length,s=Array(u>1?u-1:0),c=1;c<u;c++)s[c-1]=arguments[c];for(var p=Math.min(o.length,s.length),y=0;y<p;y++){var l=i[o[y]];l.bound=s[y]}}return t}},{key:"module",value:function(t,e){var r=new St(this);r.name=t;var n=this.createContext();return n[et]=this,n[at]=r,r.innerContext=n,e(n),r}},{key:"moduleExports",value:function(t){var e=this[at];if(!e)throw new Error("Cannot declare module.exports outside of a module.");var r=new jt(this);return r.type=t,e.moduleExports=r,r}},{key:"var",value:function(t,e){var r=new Tt(this);return r.name=t,r.type=e,r}},{key:"class",value:function(t,e){if("function"==typeof e){var r=new Nt(this);return r.name=t,r.bodyCreator=e,r}var n=new Pt(this);n.name=t;for(var a=arguments.length,i=Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];null!=e&&i.unshift(e);for(var u,s=i.length,c=[],p=void 0,y=0;y<s;y++){var l=i[y];if(l instanceof mt||l instanceof kt)c.push(l);else if(l instanceof Ct)ht(!p,"Class body must only be declared once."),p=l;else if(l instanceof xt)ht(!n.superClass,"Classes can only have one super class."),n.superClass=l;else{if(null==l||"object"!=typeof l||l instanceof I)throw new Error("ClassDeclaration cannot contain the given type directly.");for(var f in l)c.push(this.property(f,l[f]))}}(p||(p=new Ct(this)),c.length)&&(u=p.properties).push.apply(u,c);return n.body=p,n}},{key:"extends",value:function(t){for(var e=new xt(this),r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return e.type=this.ref.apply(this,[t].concat(p(n))),e}},{key:"fn",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.function.apply(this,[t].concat(r))}},{key:"function",value:function(t){if("function"==typeof t){var e=new Bt(this);return e.bodyCreator=t,e}var r=new pt(this);if(null!=t){for(var n=arguments.length,a=Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];a.unshift(t);for(var o=a.length,u=0;u<o;u++){var s=a[u];if(s instanceof Z)r.params.push(s);else if(s instanceof Q)r.rest=s;else{if(!(s instanceof tt))throw new Error("FunctionType cannot contain the given type directly.");r.returnType=s}}}return r.returnType||(r.returnType=this.any()),r}},{key:"param",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new Z(this);return n.name=t,n.type=e,n.optional=r,n}},{key:"rest",value:function(t,e){var r=new Q(this);return r.name=t,r.type=e,r}},{key:"return",value:function(t){var e=new tt(this);return e.type=t,e}},{key:"generator",value:function(t,e,r){var n=new yt(this);return n.yieldType=t,n.returnType=e||this.any(),n.nextType=r||this.any(),n}},{key:"object",value:function(t){var e=new Ct(this);if(null==t||"object"!=typeof t||t instanceof I){for(var r=void 0,n=arguments.length,a=Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];for(var o=r=t?[t].concat(p(a)):a,u=o.length,s=0;s<u;s++){var c=r[s];if(c instanceof mt)e.properties.push(c);else if(c instanceof kt)e.indexers.push(c);else{if(!(c instanceof _t))throw new Error("ObjectType cannot contain the given type directly.");e.callProperties.push(c)}}}else for(var y in t)e.properties.push(this.property(y,t[y]));return e}},{key:"exactObject",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var a=this.object.apply(this,[t].concat(p(r)));return a.exact=!0,a}},{key:"callProperty",value:function(t){var e=new _t(this);return e.value=t,e}},{key:"property",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new mt(this);return n.key=t,n.value=e instanceof I?e:this.object(e),n.optional=r,n}},{key:"indexer",value:function(t,e,r){var n=new kt(this);return n.id=t,n.key=e,n.value=r,n}},{key:"method",value:function(t,e){var r=new mt(this);r.key=t;for(var n=arguments.length,a=Array(n>2?n-2:0),i=2;i<n;i++)a[i-2]=arguments[i];return r.value=this.function.apply(this,[e].concat(a)),r}},{key:"staticCallProperty",value:function(t){var e=this.callProperty(t);return e.static=!0,e}},{key:"staticProperty",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.property(t,e,r);return n.static=!0,n}},{key:"staticMethod",value:function(t,e){for(var r=arguments.length,n=Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];var i=this.method.apply(this,[t,e].concat(n));return i.static=!0,i}},{key:"spread",value:function(){for(var t=new Ct(this),e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];for(var a=0;a<r.length;a++){var i,o,u=r[a].unwrap();if(Array.isArray(u.callProperties))(i=t.callProperties).push.apply(i,p(u.callProperties));if(Array.isArray(u.indexers))(o=t.indexers).push.apply(o,p(u.indexers));if(Array.isArray(u.properties))for(var s=0;s<u.properties.length;s++){var c=u.properties[s];ht(c instanceof mt),t.setProperty(c.key,c.value,c.optional)}}return t}},{key:"tuple",value:function(){for(var t=new D(this),e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.types=r,t}},{key:"array",value:function(t){var e=new W(this);return e.elementType=t||this.any(),e}},{key:"union",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return ce(this,e)}},{key:"intersect",value:function(){for(var t=new $t(this),e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.types=r,t}},{key:"intersection",value:function(){return this.intersect.apply(this,arguments)}},{key:"box",value:function(t){var e=new Qt(this);return e.reveal=t,e}},{key:"tdz",value:function(t,e){var r=new ae(this);return r.reveal=t,r.name=e,r}},{key:"ref",value:function(t){var e,r=void 0;if("string"==typeof t)(r=this.get(t))||((r=new te(this)).name=t);else if("function"==typeof t){var n=this[it];(r=n.get(t))||((r=new bt(this)).impl=t,r.name=t.name)}else{if(!(t instanceof I))return null==t||"object"!=typeof t?this.emitWarningMessage(`Could not reference the given type, try t.typeOf(value) instead. (got ${String(t)})`):xe.has(t)||(this.emitWarningMessage("Could not reference the given type, try t.typeOf(value) instead."),xe.add(t)),this.any();r=t}for(var a=arguments.length,i=Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];return i.length?(ht("function"==typeof r.apply,`Cannot apply non-applicable type: ${r.typeName}.`),(e=r).apply.apply(e,p(i))):r}},{key:"validate",value:function(t,e){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments[3],i=new O(this,e);a?(r=i.path).push.apply(r,p(a)):"string"==typeof t.name&&i.path.push(t.name);return i.prefix=n,i.errors=Array.from(t.errors(i,[],e)),i}},{key:"check",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments[3];return"assert"===this.mode?this.assert(t,e,r,n):this.warn(t,e,r,n)}},{key:"assert",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments[3],a=this.validate(t,e,r,n),i=this.makeTypeError(a);if(i)throw i;return e}},{key:"warn",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments[3],a=this.validate(t,e,r,n),i=se(a);return"string"==typeof i&&this.emitWarningMessage(i),e}},{key:"emitWarningMessage",value:function(t){console.warn("flow-runtime:",t)}},{key:"propTypes",value:function(t){return function(t){var e={};if(!t.properties)return e;var r=function(t){e[t.key]=function(e,r,n){return C(t,e)}},n=!0,a=!1,i=void 0;try{for(var o,u=t.properties[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){r(o.value)}}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}return e}(t.unwrap())}},{key:"match",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e.pop();if(!Array.isArray(n))throw new Error("Invalid pattern, last argument must be an array.");var a=this.pattern.apply(this,p(n));return a.apply(void 0,e)}},{key:"pattern",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=e.length,a=new Array(n),i=0;i<n;i++){var o=e[i],u=this.getAnnotation(o);if(u)ht(u instanceof pt||u instanceof Bt,"Pattern clauses must be annotated functions."),a[i]=u;else{if(i!==n-1)throw new Error(`Invalid Pattern - found unannotated function in position ${i}, default clauses must be last.`);a[i]=!0}}return function(){for(var t=0;t<a.length;t++){var r=a[t],n=e[t];if(!0===r)return n.apply(void 0,arguments);if(r.acceptsParams.apply(r,arguments))return n.apply(void 0,arguments)}var i=new TypeError("Value did not match any of the candidates.");throw i.name="RuntimeTypeError",i}}},{key:"wrapIterator",value:function(t){var e=this;return function*(r){var n=!0,a=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;yield e.check(t,s)}}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}}}},{key:"refinement",value:function(t){var e=new Lt(this);e.type=t;for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return e.addConstraint.apply(e,p(n)),e}},{key:"$exact",value:function(t){var e,r,n,a=new Ct(this);(t=t.unwrap(),Array.isArray(t.callProperties))&&(e=a.callProperties).push.apply(e,p(t.callProperties));Array.isArray(t.indexers)&&(r=a.indexers).push.apply(r,p(t.indexers));Array.isArray(t.properties)&&(n=a.properties).push.apply(n,p(t.properties));return a.exact=!0,a}},{key:"$diff",value:function(t,e){var r=new he(this);return r.aType=t,r.bType=e,r}},{key:"$flowFixMe",value:function(){return new ve(this)}},{key:"$keys",value:function(t){var e=new de(this);return e.type=t,e}},{key:"$objMap",value:function(t,e){var r=new me(this);return r.object=t,r.mapper=e,r}},{key:"$objMapi",value:function(t,e){var r=new ge(this);return r.object=t,r.mapper=e,r}},{key:"$propertyType",value:function(t,e){var r=new ke(this);if(r.object=t,e instanceof I){var n=e.unwrap();r.property=n.value}else r.property=e;return r}},{key:"$shape",value:function(t){var e=new _e(this);return e.type=t,e}},{key:"$subtype",value:function(t){var e=new Ee(this);return e.type=t,e}},{key:"$supertype",value:function(t){var e=new Te(this);return e.type=t,e}},{key:"$tupleMap",value:function(t,e){var r=new Oe(this);return r.tuple=t,r.mapper=e,r}},{key:"$values",value:function(t){var e=new Se(this);return e.type=t,e}},{key:"Class",value:function(t){var e=new Ae(this);return e.instanceType=t,e}},{key:"TypeParametersSymbol",get:function(){return st}}]),t}(),Re=void 0;"undefined"!=typeof global&&void 0!==global.__FLOW_RUNTIME_GLOBAL_CONTEXT_DO_NOT_USE_THIS_VARIABLE__?Re=global.__FLOW_RUNTIME_GLOBAL_CONTEXT_DO_NOT_USE_THIS_VARIABLE__:(Re=new Ce,Ne=Re,n.null=Object.freeze(new vt(Ne)),n.empty=Object.freeze(new J(Ne)),n.number=Object.freeze(new Ut(Ne)),n.boolean=Object.freeze(new X(Ne)),n.string=Object.freeze(new Ft(Ne)),n.symbol=Object.freeze(new Yt(Ne)),n.any=Object.freeze(new $(Ne)),n.mixed=Object.freeze(new Dt(Ne)),n.void=Object.freeze(new dt(Ne)),n.existential=Object.freeze(new B(Ne)),function(t){t.declareTypeConstructor({name:"Date",impl:Date,typeName:"DateType",*errors(t,e,r){r instanceof Date?isNaN(r.getTime())&&(yield[e,z("ERR_INVALID_DATE"),this]):yield[e,z("ERR_EXPECT_INSTANCEOF","Date"),this]},accepts:t=>t instanceof Date&&!isNaN(t.getTime()),compareWith:t=>"DateType"===t.typeName?0:-1,inferTypeParameters:t=>[]}),t.declareTypeConstructor({name:"Promise",impl:Promise,typeName:"PromiseType",*errors(t,e,r,n){ht(n,"Must specify type parameter for Promise."),this.context.checkPredicate("Promise",r)||(yield[e,z("ERR_EXPECT_PROMISE",n),this])},accepts(t){return this.context.checkPredicate("Promise",t)},compareWith:t=>"PromiseType"===t.typeName?0:-1,inferTypeParameters:t=>[]}),t.declareTypeConstructor({name:"Map",impl:Map,typeName:"MapType",*errors(t,e,r,n,a){if(ht(n,"Must specify two type parameters for Map."),ht(a,"Must specify two type parameters for Map."),this.context.checkPredicate("Map",r)){var i=!0,o=!1,u=void 0;try{for(var s,p=r[Symbol.iterator]();!(i=(s=p.next()).done);i=!0){var y=s.value,l=c(y,2),f=l[0],b=l[1];n.accepts(f)||(yield[e,z("ERR_EXPECT_KEY_TYPE",n),this]),yield*a.errors(t,e.concat(f),b)}}catch(t){o=!0,u=t}finally{try{!i&&p.return&&p.return()}finally{if(o)throw u}}}else yield[e,z("ERR_EXPECT_INSTANCEOF","Map"),this]},accepts(t,e,r){if(!this.context.checkPredicate("Map",t))return!1;var n=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,p=c(s,2),y=p[0],l=p[1];if(!e.accepts(y)||!r.accepts(l))return!1}}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}return!0},compareWith:t=>"MapType"===t.typeName?0:-1,inferTypeParameters(e){var r=[],n=[],a=!0,i=!1,o=void 0;try{t:for(var u,s=e[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var p=u.value,y=c(p,2),l=y[0],f=y[1];e:{for(var b=0;b<r.length;b++){if(r[b].accepts(l))break e}r.push(t.typeOf(l))}for(var h=0;h<n.length;h++){if(n[h].accepts(f))continue t}n.push(t.typeOf(f))}}catch(t){i=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}var v=[];return 0===r.length?v.push(t.existential()):1===r.length?v.push(r[0]):v.push(t.union.apply(t,r)),0===n.length?v.push(t.existential()):1===n.length?v.push(n[0]):v.push(t.union.apply(t,n)),v}}),t.declareTypeConstructor({name:"Set",impl:Set,typeName:"SetType",*errors(t,e,r,n){if(ht(n,"Must specify type parameter for Set."),this.context.checkPredicate("Set",r)){var a=!0,i=!1,o=void 0;try{for(var u,s=r[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var c=u.value;yield*n.errors(t,e,c)}}catch(t){i=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}}else yield[e,z("ERR_EXPECT_INSTANCEOF","Set"),this]},accepts(t,e){if(!this.context.checkPredicate("Set",t))return!1;var r=!0,n=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var u=i.value;if(!e.accepts(u))return!1}}catch(t){n=!0,a=t}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return!0},compareWith:t=>"SetType"===t.typeName?0:-1,inferTypeParameters(e){var r=[],n=!0,a=!1,i=void 0;try{t:for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){for(var s=o.value,c=0;c<r.length;c++){if(r[c].accepts(s))continue t}r.push(t.typeOf(s))}}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}return 0===r.length?[t.existential()]:1===r.length?[r[0]]:[t.union.apply(t,r)]}})}(Re),(we=Re).setPredicate("Array",(function(t){return Array.isArray(t)})),we.setPredicate("Map",(function(t){return t instanceof Map})),we.setPredicate("Set",(function(t){return t instanceof Set})),we.setPredicate("Promise",(function(t){return t instanceof Promise||null!==t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then})),"undefined"!=typeof global&&(global.__FLOW_RUNTIME_GLOBAL_CONTEXT_DO_NOT_USE_THIS_VARIABLE__=Re));var Ie=Re;e.b=Ie},function(t,e,r){"use strict";var n=r(5),a=r(0),i=a.b.type("Range",a.b.ref("$ReadOnly",a.b.object(a.b.property("from",a.b.number()),a.b.property("to",a.b.number())))),o=i.assert({from:0,to:0}),u=r(9),s=r(3);r.d(e,"a",(function(){return v})),r.d(e,"b",(function(){return d})),r.d(e,"c",(function(){return g})),r.d(e,"d",(function(){return m})),r.d(e,"n",(function(){return k})),r.d(e,"o",(function(){return _})),r.d(e,"p",(function(){return E})),r.d(e,"q",(function(){return T})),r.d(e,"r",(function(){return O})),r.d(e,"s",(function(){return S})),r.d(e,"t",(function(){return j})),r.d(e,"u",(function(){return P})),r.d(e,"v",(function(){return w})),r.d(e,"w",(function(){return N})),r.d(e,"l",(function(){return M})),r.d(e,"g",(function(){return J})),r.d(e,"f",(function(){return G})),r.d(e,"k",(function(){return Q})),r.d(e,"h",(function(){return tt})),r.d(e,"i",(function(){return et})),r.d(e,"m",(function(){return nt})),r.d(e,"e",(function(){return it})),r.d(e,"D",(function(){return ot})),r.d(e,"j",(function(){return ut})),r.d(e,"x",(function(){return st})),r.d(e,"y",(function(){return ct})),r.d(e,"A",(function(){return lt})),r.d(e,"z",(function(){return ft})),r.d(e,"B",(function(){return bt})),r.d(e,"C",(function(){return ht})),r.d(e,"E",(function(){return vt}));var c=a.b.tdz(()=>i),p=a.b.tdz(()=>n.a),y=a.b.string("ARMOR_NONE").assert("ARMOR_NONE"),l=a.b.string("ARMOR_LIGHT").assert("ARMOR_LIGHT"),f=a.b.string("ARMOR_MEDIUM").assert("ARMOR_MEDIUM"),b=a.b.string("ARMOR_HEAVY").assert("ARMOR_HEAVY"),h=a.b.type("ArmorType",a.b.union(a.b.typeOf(y),a.b.typeOf(l),a.b.typeOf(f),a.b.typeOf(b))),v=a.b.string("BUILDING_LUMBER_MILL").assert("BUILDING_LUMBER_MILL"),d=a.b.string("BUILDING_PASTURE").assert("BUILDING_PASTURE"),g=a.b.string("BUILDING_WAREHOUSE").assert("BUILDING_WAREHOUSE"),m=a.b.type("BuildingType",a.b.union(a.b.typeOf(v),a.b.typeOf(d),a.b.typeOf(g))),k=a.b.string("RESOURCE_FOOD").assert("RESOURCE_FOOD"),_=a.b.string("RESOURCE_WOOD").assert("RESOURCE_WOOD"),E=a.b.type("ResourceType",a.b.union(a.b.typeOf(k),a.b.typeOf(_))),T=a.b.string("UNIT_ARCHER").assert("UNIT_ARCHER"),O=a.b.string("UNIT_CATAPULT").assert("UNIT_CATAPULT"),S=a.b.string("UNIT_KNIGHT").assert("UNIT_KNIGHT"),j=a.b.string("UNIT_NOBLE").assert("UNIT_NOBLE"),P=a.b.string("UNIT_PEASANT").assert("UNIT_PEASANT"),w=a.b.string("UNIT_PIKEMAN").assert("UNIT_PIKEMAN"),N=a.b.string("UNIT_SWORDSMAN").assert("UNIT_SWORDSMAN"),A=a.b.type("UnitType",a.b.union(a.b.typeOf(T),a.b.typeOf(O),a.b.typeOf(S),a.b.typeOf(j),a.b.typeOf(P),a.b.typeOf(w),a.b.typeOf(N))),x={tier:0},C=a.b.type("CommonStateBuilding",a.b.typeOf(x)),R=a.b.object(a.b.indexer("key",m,C)).assert({[v]:x,[d]:x,[g]:x}),I=a.b.type("CommonStateBuildings",a.b.typeOf(R)),$=a.b.object(a.b.indexer("key",A,a.b.number())).assert({[T]:0,[O]:0,[S]:0,[j]:0,[P]:0,[w]:0,[N]:0}),M=a.b.type("CommonStateUnits",a.b.typeOf($)),z=a.b.object(a.b.indexer("key",A,a.b.ref(c))).assert({[T]:o,[O]:o,[S]:o,[j]:o,[P]:o,[w]:o,[N]:o}),D=(a.b.type("RegimentTemplate",a.b.typeOf(z)),a.b.object(a.b.indexer("key",E,a.b.number())).assert({[k]:0,[_]:0})),W=a.b.type("CommonStateResources",a.b.typeOf(D)),U={buildings:R,units:$,location:s.d,name:"",resources:D},X={...U,ownerId:null},J=a.b.type("CommonStateCity",a.b.object(...a.b.typeOf(U).properties,a.b.property("ownerId",a.b.nullable(a.b.string())))),B=a.b.object(a.b.indexer("key",a.b.string(),J)).assert(Object.freeze({})),G=a.b.type("CommonStateCities",a.b.typeOf(B)),L=a.b.object(a.b.indexer("key",E,a.b.number())).assert({[k]:0,[_]:0}),q=a.b.type("CommonStateBuildingUpgradeCost",a.b.typeOf(L)),F=a.b.object(a.b.indexer("key",m,q)).assert({[v]:L,[d]:L,[g]:L}),V=(a.b.type("CommonStateBuildingUpgradeCosts",a.b.typeOf(F)),a.b.object(a.b.indexer("key",h,a.b.number())).assert({[y]:0,[l]:0,[f]:0,[b]:0})),Y=(a.b.type("CommonStateDamage",a.b.typeOf(V)),{armor:y,damage:V,foodDemand:0,range:0,speed:0}),H=a.b.type("CommonStateUnitStat",a.b.object(...a.b.typeOf(Y).properties,a.b.property("armor",h))),K=a.b.object(a.b.indexer("key",A,H)).assert({[T]:Y,[O]:Y,[S]:Y,[j]:Y,[P]:Y,[w]:Y,[N]:Y}),Q=a.b.type("CommonStateUnitStats",a.b.typeOf(K)),Z={baseCityCapacity:0,basePeasantsMigrationRate:0,buildingUpgradeCoefficient:0,buildingUpgradeCosts:F,minimalCityMargin:{x:0,y:0},populationGrowthChangeRateCoefficient:0,resourceIncreaseChangeRateCoefficient:0,unitFoodDemand:0,unitStarvingCoefficient:0,unitStats:K},tt=a.b.type("CommonStateRules",a.b.typeOf(Z)),et=a.b.type("CommonStateTime",a.b.typeOf("")),rt={size:s.d},nt=a.b.type("CommonStateWorld",a.b.typeOf(rt)),at={cities:B,rules:Z,time:"",world:rt},it=a.b.type("CommonState",a.b.typeOf(at)),ot=it.assert({cities:{},rules:{baseCityCapacity:1e3,basePeasantsMigrationRate:100,buildingUpgradeCoefficient:.5,buildingUpgradeCosts:{[v]:{[k]:0,[_]:100},[d]:{[k]:0,[_]:50},[g]:{[k]:0,[_]:200}},minimalCityMargin:{x:3,y:3},populationGrowthChangeRateCoefficient:1,resourceIncreaseChangeRateCoefficient:1e4,unitFoodDemand:1,unitStarvingCoefficient:.2,unitStats:{[T]:{armor:l,damage:{[y]:10,[l]:5,[f]:1,[b]:0},foodDemand:1,range:0,speed:10},[O]:{armor:b,damage:{[y]:100,[l]:100,[f]:100,[b]:100},foodDemand:2,range:0,speed:1},[S]:{armor:f,damage:{[y]:20,[l]:10,[f]:5,[b]:2},foodDemand:3,range:0,speed:50},[j]:{armor:y,damage:{[y]:0,[l]:0,[f]:0,[b]:0},foodDemand:100,range:0,speed:1},[P]:{armor:y,damage:{[y]:4,[l]:2,[f]:1,[b]:0},foodDemand:1,range:0,speed:10},[w]:{armor:l,damage:{[y]:8,[l]:4,[f]:2,[b]:1},foodDemand:1,range:0,speed:10},[N]:{armor:b,damage:{[y]:20,[l]:10,[f]:5,[b]:2},foodDemand:1,range:0,speed:2}}},time:(new Date).toISOString(),world:{size:{x:10,y:10}}}),ut=it,st=a.b.annotate((function(t){var e=a.b.return(a.b.number()),{buildings:r}=a.b.object(a.b.property("buildings",I)).assert(t);return e.assert(Object.keys(r).reduce((t,e)=>t+r[e].tier,0))}),a.b.function(a.b.param("_arg",a.b.object(a.b.property("buildings",I))),a.b.return(a.b.number()))),ct=a.b.annotate((function(t){var e=a.b.return(W),{buildingTier:r,buildingType:i,rules:o}=a.b.object(a.b.property("buildingTier",a.b.number()),a.b.property("buildingType",m),a.b.property("rules",tt)).assert(t),s=1+r*o.buildingUpgradeCoefficient;return e.assert(Object(u.a)({quantities:Object(n.b)({quantities:o.buildingUpgradeCosts[i],scalar:s})}))}),a.b.function(a.b.param("_arg",a.b.object(a.b.property("buildingTier",a.b.number()),a.b.property("buildingType",m),a.b.property("rules",tt))),a.b.return(W))),pt=a.b.annotate((function(t){var e=a.b.return(a.b.ref(p)),{unitsQuantity:r,pastureTier:n,rules:i}=a.b.object(a.b.property("unitsQuantity",a.b.number()),a.b.property("pastureTier",a.b.number()),a.b.property("rules",tt)).assert(t);return e.assert({"units maintenance":-r*i.unitFoodDemand,"pasture production":i.resourceIncreaseChangeRateCoefficient*n,"peasants production":r*i.unitFoodDemand})}),a.b.function(a.b.param("_arg",a.b.object(a.b.property("unitsQuantity",a.b.number()),a.b.property("pastureTier",a.b.number()),a.b.property("rules",tt))),a.b.return(a.b.ref(p)))),yt=a.b.annotate((function(t){var e=a.b.return(a.b.ref(p)),{unitsQuantity:r,lumberMillTier:n,rules:i}=a.b.object(a.b.property("unitsQuantity",a.b.number()),a.b.property("lumberMillTier",a.b.number()),a.b.property("rules",tt)).assert(t);return e.assert({"lumber mill production":i.resourceIncreaseChangeRateCoefficient*n,"peasants production":r})}),a.b.function(a.b.param("_arg",a.b.object(a.b.property("unitsQuantity",a.b.number()),a.b.property("lumberMillTier",a.b.number()),a.b.property("rules",tt))),a.b.return(a.b.ref(p)))),lt=a.b.annotate((function(t){var e=a.b.return(a.b.ref(p)),{city:r,resourceType:n,rules:i}=a.b.object(a.b.property("city",J),a.b.property("resourceType",E),a.b.property("rules",tt)).assert(t);switch(n){case k:return e.assert(pt({unitsQuantity:r.units[P],pastureTier:r.buildings[d].tier,rules:i}));case _:return e.assert(yt({unitsQuantity:r.units[P],lumberMillTier:r.buildings[v].tier,rules:i}));default:throw Error(`unsupported resource type: ${n}`)}}),a.b.function(a.b.param("_arg",a.b.object(a.b.property("city",J),a.b.property("resourceType",E),a.b.property("rules",tt))),a.b.return(a.b.ref(p)))),ft=a.b.annotate((function(t){var{buildingTiersSum:e,unitsQuantity:r,food:n,foodChangeRate:i,rules:o}=a.b.object(a.b.property("buildingTiersSum",a.b.number()),a.b.property("unitsQuantity",a.b.number()),a.b.property("food",a.b.number()),a.b.property("foodChangeRate",a.b.number()),a.b.property("rules",tt)).assert(t),u=n>0||i>0?0:Math.abs(i*o.unitFoodDemand),s=o.baseCityCapacity+Math.max(0,o.baseCityCapacity*e-u*o.unitStarvingCoefficient),c=0===r?0:u/r;return{growth:o.populationGrowthChangeRateCoefficient*r*(1-r/s),migration:u>0?-o.basePeasantsMigrationRate*c:o.basePeasantsMigrationRate}}),a.b.function(a.b.param("_arg",a.b.object(a.b.property("buildingTiersSum",a.b.number()),a.b.property("unitsQuantity",a.b.number()),a.b.property("food",a.b.number()),a.b.property("foodChangeRate",a.b.number()),a.b.property("rules",tt))))),bt=a.b.annotate((function(t){var e=a.b.return(a.b.number()),{changeInfo:r}=a.b.object(a.b.property("changeInfo",a.b.ref(p))).assert(t);return e.assert(Object.keys(r).map(t=>r[t]).reduce((t,e)=>t+e,0))}),a.b.function(a.b.param("_arg",a.b.object(a.b.property("changeInfo",a.b.ref(p)))),a.b.return(a.b.number()))),ht=a.b.annotate((function(t){var e=a.b.return(a.b.number()),{changeRate:r,timeDelta:n}=a.b.object(a.b.property("changeRate",a.b.number()),a.b.property("timeDelta",a.b.number())).assert(t);return e.assert(r/3600*n)}),a.b.function(a.b.param("_arg",a.b.object(a.b.property("changeRate",a.b.number()),a.b.property("timeDelta",a.b.number()))),a.b.return(a.b.number()))),vt=it.assert({cities:{1:{...X,location:{x:0,y:0},name:"Trzebinia",ownerId:"test1",units:{...X.units,[P]:1e3,[w]:100}},2:{...X,location:{x:3,y:0},name:"Krakow",ownerId:"test1"},3:{...X,location:{x:0,y:-3},name:"Warszawa",ownerId:"test2"},4:{...X,location:{x:0,y:3},name:"Poznan",ownerId:"test3"}},rules:{baseCityCapacity:1e3,basePeasantsMigrationRate:100,buildingUpgradeCoefficient:.5,buildingUpgradeCosts:{[v]:{[k]:0,[_]:100},[d]:{[k]:0,[_]:50},[g]:{[k]:0,[_]:200}},minimalCityMargin:{x:3,y:3},populationGrowthChangeRateCoefficient:1,resourceIncreaseChangeRateCoefficient:1e4,unitFoodDemand:1,unitStarvingCoefficient:.2,unitStats:{[T]:{armor:l,damage:{[y]:10,[l]:5,[f]:1,[b]:0},foodDemand:1,range:0,speed:10},[O]:{armor:b,damage:{[y]:100,[l]:100,[f]:100,[b]:100},foodDemand:2,range:0,speed:1},[S]:{armor:f,damage:{[y]:20,[l]:10,[f]:5,[b]:2},foodDemand:3,range:0,speed:50},[j]:{armor:y,damage:{[y]:0,[l]:0,[f]:0,[b]:0},foodDemand:100,range:0,speed:1},[P]:{armor:y,damage:{[y]:4,[l]:2,[f]:1,[b]:0},foodDemand:1,range:0,speed:10},[w]:{armor:l,damage:{[y]:8,[l]:4,[f]:2,[b]:1},foodDemand:1,range:0,speed:10},[N]:{armor:b,damage:{[y]:20,[l]:10,[f]:5,[b]:2},foodDemand:1,range:0,speed:2}}},time:(new Date).toISOString(),world:{size:{x:10,y:10}}})},function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"d",(function(){return p})),r.d(e,"h",(function(){return l})),r.d(e,"e",(function(){return f})),r.d(e,"j",(function(){return b})),r.d(e,"c",(function(){return h})),r.d(e,"b",(function(){return v})),r.d(e,"k",(function(){return d})),r.d(e,"f",(function(){return g})),r.d(e,"g",(function(){return m})),r.d(e,"i",(function(){return k}));var n=r(0),a=r(1),i=r(6),o=n.b.tdz(()=>a.d),u=n.b.tdz(()=>a.e),s=(n.b.tdz(()=>n.a),n.b.type("ServerDummyAction",n.b.ref("$ReadOnly",n.b.object(n.b.property("type",n.b.string("DUMMY")),n.b.property("payload",n.b.void()))))),c=n.b.type("ServerAbandonCityAction",n.b.ref("$ReadOnly",n.b.object(n.b.property("type",n.b.string("ABANDON_CITY")),n.b.property("payload",n.b.object(n.b.property("cityId",n.b.string()),n.b.property("playerId",n.b.string())))))),p=n.b.type("ServerCreateCityAction",n.b.ref("$ReadOnly",n.b.object(n.b.property("type",n.b.string("CREATE_CITY")),n.b.property("payload",n.b.object(n.b.property("cityId",n.b.string()),n.b.property("cityName",n.b.string()),n.b.property("playerId",n.b.string())))))),y=n.b.type("ServerGetCurrentStateAction",n.b.ref("$ReadOnly",n.b.object(n.b.property("type",n.b.string("GET_CURRENT_STATE"))))),l=n.b.type("ServerResetStateAction",n.b.ref("$ReadOnly",n.b.object(n.b.property("type",n.b.string("RESET_STATE"))))),f=n.b.type("ServerExecuteTimeStepAction",n.b.ref("$ReadOnly",n.b.object(n.b.property("type",n.b.string("EXECUTE_TIME_STEP")),n.b.property("payload",n.b.string())))),b=n.b.type("ServerUpgradeBuildingAction",n.b.ref("$ReadOnly",n.b.object(n.b.property("type",n.b.string("UPGRADE_BUILDING")),n.b.property("payload",n.b.object(n.b.property("buildingType",n.b.ref(o)),n.b.property("cityId",n.b.string()),n.b.property("playerId",n.b.string())))))),h=n.b.type("ServerChangeCityNameAction",n.b.ref("$ReadOnly",n.b.object(n.b.property("type",n.b.string("CHANGE_CITY_NAME")),n.b.property("payload",n.b.object(n.b.property("cityId",n.b.string()),n.b.property("name",n.b.string()),n.b.property("playerId",n.b.string())))))),v=n.b.type("ServerAction",n.b.union(c,p,h,s,y,l,f,b)),d=(n.b.annotate((function(t){var e=n.b.return(c),{cityId:r,playerId:a}=n.b.object(n.b.property("cityId",n.b.string()),n.b.property("playerId",n.b.string())).assert(t);return e.assert({type:"ABANDON_CITY",payload:{cityId:r,playerId:a}})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("cityId",n.b.string()),n.b.property("playerId",n.b.string()))),n.b.return(c))),n.b.annotate((function(t){var e=n.b.return(p),{cityId:r,cityName:a,playerId:i}=n.b.object(n.b.property("cityId",n.b.string()),n.b.property("cityName",n.b.string()),n.b.property("playerId",n.b.string())).assert(t);return e.assert({type:"CREATE_CITY",payload:{cityId:r,cityName:a,playerId:i}})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("cityId",n.b.string()),n.b.property("cityName",n.b.string()),n.b.property("playerId",n.b.string()))),n.b.return(p))),n.b.annotate((function(){return n.b.return(y).assert({type:"GET_CURRENT_STATE"})}),n.b.function(n.b.return(y))),n.b.annotate((function(){return n.b.return(l).assert({type:"RESET_STATE"})}),n.b.function(n.b.return(l))),n.b.annotate((function(t){var e=n.b.return(f),{time:r}=n.b.object(n.b.property("time",n.b.string())).assert(t);return e.assert({type:"EXECUTE_TIME_STEP",payload:r})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("time",n.b.string()))),n.b.return(f)))),g=(n.b.annotate((function(t){var e=n.b.return(b),{cityId:r,buildingType:a,playerId:i}=n.b.object(n.b.property("cityId",n.b.string()),n.b.property("buildingType",n.b.ref(o)),n.b.property("playerId",n.b.string())).assert(t);return e.assert({type:"UPGRADE_BUILDING",payload:{buildingType:a,cityId:r,playerId:i}})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("cityId",n.b.string()),n.b.property("buildingType",n.b.ref(o)),n.b.property("playerId",n.b.string()))),n.b.return(b))),n.b.annotate((function(t){var e=n.b.return(h),{cityId:r,name:a,playerId:i}=n.b.object(n.b.property("cityId",n.b.string()),n.b.property("name",n.b.string()),n.b.property("playerId",n.b.string())).assert(t);return e.assert({type:"CHANGE_CITY_NAME",payload:{cityId:r,name:a,playerId:i}})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("cityId",n.b.string()),n.b.property("name",n.b.string()),n.b.property("playerId",n.b.string()))),n.b.return(h))),n.b.type("ServerRequest",v)),m=g,k=n.b.type("ServerResponse",n.b.object(n.b.property("request",v),n.b.property("errors",n.b.ref("$ReadOnlyArray",n.b.string())),n.b.property("state",n.b.ref(u)))),_=k;n.b.annotate((function(t){var e=n.b.return(k),{json:r}=n.b.object(n.b.property("json",n.b.string())).assert(t),a=Object(i.a)({json:r});return e.assert(_.assert(a))}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("json",n.b.string()))),n.b.return(k))),n.b.annotate((function(){return n.b.return(s).assert({type:"DUMMY",payload:void 0})}),n.b.function(n.b.return(s)))},function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"d",(function(){return i})),r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return u}));var n=r(0),a=n.b.type("Vector",n.b.ref("$ReadOnly",n.b.object(n.b.property("x",n.b.number()),n.b.property("y",n.b.number())))),i=a.assert({x:0,y:0}),o=n.b.annotate((function(t){var e=n.b.return(a),{vector1:r,vector2:i}=n.b.object(n.b.property("vector1",a),n.b.property("vector2",a)).assert(t);return e.assert({x:r.x+i.x,y:r.y+i.y})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("vector1",a),n.b.property("vector2",a))),n.b.return(a))),u=(n.b.annotate((function(t){var e=n.b.return(a),{vector1:r,vector2:i}=n.b.object(n.b.property("vector1",a),n.b.property("vector2",a)).assert(t);return e.assert({x:r.x-i.x,y:r.y-i.y})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("vector1",a),n.b.property("vector2",a))),n.b.return(a))),n.b.annotate((function(t){var e=n.b.return(a),{vector1:r,vector2:i}=n.b.object(n.b.property("vector1",a),n.b.property("vector2",a)).assert(t);return e.assert({x:r.x*i.x,y:r.y*i.y})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("vector1",a),n.b.property("vector2",a))),n.b.return(a))),n.b.annotate((function(t){var e=n.b.return(a),{vector1:r,vector2:i}=n.b.object(n.b.property("vector1",a),n.b.property("vector2",a)).assert(t);return e.assert({x:r.x/i.x,y:r.y/i.y})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("vector1",a),n.b.property("vector2",a))),n.b.return(a))),n.b.annotate((function(t){var e=n.b.return(a),{vector:r}=n.b.object(n.b.property("vector",a)).assert(t);return e.assert({x:-r.x,y:-r.y})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("vector",a))),n.b.return(a))),n.b.annotate((function(t){var e=n.b.return(n.b.number()),{vector1:r,vector2:i}=n.b.object(n.b.property("vector1",a),n.b.property("vector2",a)).assert(t),o=r.x-i.x,u=r.y-i.y;return e.assert(Math.sqrt(o*o+u*u))}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("vector1",a),n.b.property("vector2",a))),n.b.return(n.b.number()))));n.b.annotate((function(t){var e=n.b.return(n.b.boolean()),{vector1:r,vector2:i}=n.b.object(n.b.property("vector1",a),n.b.property("vector2",a)).assert(t);return e.assert(r.x===i.x&&r.y===i.y)}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("vector1",a),n.b.property("vector2",a))),n.b.return(n.b.boolean())))},function(t,e,r){"use strict";r.d(e,"a",(function(){return g})),r.d(e,"b",(function(){return m}));var n=r(8),a=r.n(n),i=r(0),o=i.b.type("Get",i.b.function(i.b.param("_arg0",i.b.string()),i.b.return(i.b.ref("Promise",i.b.nullable(i.b.string()))))),u=i.b.type("Sadd",i.b.function(i.b.param("_arg0",i.b.string()),i.b.param("_arg1",i.b.string()),i.b.return(i.b.ref("Promise",i.b.number())))),s=i.b.type("Set",i.b.function(i.b.param("_arg0",i.b.string()),i.b.param("_arg1",i.b.string()),i.b.return(i.b.ref("Promise",i.b.void())))),c=i.b.type("Smembers",i.b.function(i.b.param("_arg0",i.b.string()),i.b.return(i.b.ref("Promise",i.b.ref("$ReadOnlyArray",i.b.string()))))),p=i.b.type("Srem",i.b.function(i.b.param("_arg0",i.b.string()),i.b.param("_arg1",i.b.string()),i.b.return(i.b.ref("Promise",i.b.number())))),y=i.b.type("Watch",i.b.function(i.b.param("_arg0",i.b.string()),i.b.return(i.b.ref("Promise",i.b.void())))),l=i.b.type("MultiGet",i.b.function(i.b.param("_arg0",i.b.string()),i.b.return(i.b.tdz(()=>d,"MultiRedis")))),f=i.b.type("MultiSadd",i.b.function(i.b.param("_arg0",i.b.string()),i.b.param("_arg1",i.b.string()),i.b.return(i.b.tdz(()=>d,"MultiRedis")))),b=i.b.type("MultiSet",i.b.function(i.b.param("_arg0",i.b.string()),i.b.param("_arg1",i.b.string()),i.b.return(i.b.tdz(()=>d,"MultiRedis")))),h=i.b.type("MultiSmembers",i.b.function(i.b.param("_arg0",i.b.string()),i.b.return(i.b.tdz(()=>d,"MultiRedis")))),v=i.b.type("MultiSrem",i.b.function(i.b.param("_arg0",i.b.string()),i.b.param("_arg1",i.b.string()),i.b.return(i.b.tdz(()=>d,"MultiRedis")))),d=i.b.type("MultiRedis",i.b.object(i.b.property("exec",i.b.function(i.b.return(i.b.ref("Promise",i.b.nullable(i.b.ref("$ReadOnlyArray",i.b.mixed())))))),i.b.property("get",l),i.b.property("sadd",f),i.b.property("set",b),i.b.property("smembers",h),i.b.property("srem",v))),g=i.b.type("Redis",i.b.object(i.b.property("get",o),i.b.property("multi",i.b.function(i.b.return(d))),i.b.property("sadd",u),i.b.property("set",s),i.b.property("smembers",c),i.b.property("srem",p),i.b.property("watch",y))),m=i.b.annotate((function(){return new a.a({host:process.env.REDIS_HOST,port:process.env.REDIS_PORT})}),i.b.function(i.b.return(g)))},function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"c",(function(){return i})),r.d(e,"b",(function(){return o}));var n=r(0),a=n.b.type("Quantities",n.b.ref("$ReadOnly",n.b.object(n.b.indexer("key",n.b.string(),n.b.number())))),i=(n.b.annotate((function(t){var{quantities1:e,quantities2:r}=n.b.object(n.b.property("quantities1",a),n.b.property("quantities2",a)).assert(t);return[...Object.keys(e),...Object.keys(r)].reduce((t,n)=>({...t,[n]:(null!=e[n]?e[n]:0)+(null!=r[n]?r[n]:0)}),{})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("quantities1",a),n.b.property("quantities2",a))))),n.b.annotate((function(t){var e=n.b.return(a),{quantities1:r,quantities2:i}=n.b.object(n.b.property("quantities1",a),n.b.property("quantities2",a)).assert(t);return e.assert([...Object.keys(r),...Object.keys(i)].reduce((t,e)=>({...t,[e]:(null!=r[e]?r[e]:0)-(null!=i[e]?i[e]:0)}),{}))}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("quantities1",a),n.b.property("quantities2",a))),n.b.return(a)))),o=(n.b.annotate((function(t){var{quantities1:e,quantities2:r}=n.b.object(n.b.property("quantities1",a),n.b.property("quantities2",a)).assert(t);return[...Object.keys(e),...Object.keys(r)].reduce((t,n)=>({...t,[n]:(null!=e[n]?e[n]:0)*(null!=r[n]?r[n]:0)}),{})}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("quantities1",a),n.b.property("quantities2",a))))),n.b.annotate((function(t){var e=n.b.return(a),{quantities:r,scalar:i}=n.b.object(n.b.property("quantities",a),n.b.property("scalar",n.b.number())).assert(t);return e.assert(Object.keys(r).reduce((t,e)=>({...t,[e]:(null!=r[e]?r[e]:0)*i}),{}))}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("quantities",a),n.b.property("scalar",n.b.number()))),n.b.return(a))));n.b.annotate((function(t){var e=n.b.return(a),{quantities1:r,quantities2:i}=n.b.object(n.b.property("quantities1",a),n.b.property("quantities2",a)).assert(t);return e.assert([...Object.keys(r),...Object.keys(i)].reduce((t,e)=>({...t,[e]:(null!=r[e]?r[e]:0)/(null!=i[e]?i[e]:0)}),{}))}),n.b.function(n.b.param("_arg",n.b.object(n.b.property("quantities1",a),n.b.property("quantities2",a))),n.b.return(a)))},function(t,e,r){"use strict";var n=r(12),a=r.n(n);function i(){return a.a.randomBytes(16)}for(var o=[],u=0;u<256;++u)o[u]=(u+256).toString(16).substr(1);var s=function(t,e){var r=e||0,n=o;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")};var c=function(t,e,r){var n=e&&r||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var o=0;o<16;++o)e[n+o]=a[o];return e||s(a)},p=r(0);r.d(e,"a",(function(){return l})),r.d(e,"b",(function(){return f}));var y=["k","m","g","t"],l=p.b.annotate((function(t){var{json:e}=t;if(void 0!==e)return null===e?"null":JSON.parse(e)}),p.b.function(p.b.param("_arg",p.b.object(p.b.property("json",p.b.nullable(p.b.string())))),p.b.return(p.b.mixed()))),f=p.b.annotate((function(t){var{value:e}=t;return JSON.stringify(e)}),p.b.function(p.b.param("_arg",p.b.object(p.b.property("value",p.b.mixed()))),p.b.return(p.b.nullable(p.b.string()))));p.b.annotate((function(){return c()}),p.b.function(p.b.return(p.b.string()))),p.b.annotate((function(t){var{value:e}=t,r=y.reduce((t,e)=>t.value/1e4<1?t:{value:t.value/1e3,suffix:e},{value:e,suffix:null});return`${r.value.toString().substring(0,4)}${null!=r.suffix?r.suffix:""}`}),p.b.function(p.b.param("_arg",p.b.object(p.b.property("value",p.b.number()))),p.b.return(p.b.string())))},function(t,e,r){"use strict";r.d(e,"b",(function(){return v})),r.d(e,"a",(function(){return m})),r.d(e,"c",(function(){return R}));var n=r(0),a=n.b.type("Handler",t=>{var e=t.typeParameter("TEvent",void 0,n.b.mixed()),r=t.typeParameter("TResult",void 0,n.b.mixed());return n.b.function(n.b.param("event",e),n.b.param("context",n.b.tdz(()=>i,"Context")),n.b.param("callback",n.b.ref(n.b.tdz(()=>p,"Callback"),r)),n.b.return(n.b.union(n.b.void(),n.b.ref("Promise",r))))}),i=n.b.type("Context",n.b.object(n.b.property("callbackWaitsForEmptyEventLoop",n.b.boolean()),n.b.property("functionName",n.b.string()),n.b.property("functionVersion",n.b.string()),n.b.property("invokedFunctionArn",n.b.string()),n.b.property("memoryLimitInMB",n.b.string()),n.b.property("awsRequestId",n.b.string()),n.b.property("logGroupName",n.b.string()),n.b.property("logStreamName",n.b.string()),n.b.property("identity",n.b.tdz(()=>o,"CognitoIdentity"),!0),n.b.property("clientContext",n.b.tdz(()=>u,"ClientContext"),!0),n.b.property("getRemainingTimeInMillis",n.b.function(n.b.return(n.b.number()))),n.b.property("done",n.b.function(n.b.param("error",n.b.ref("Error"),!0),n.b.param("result",n.b.mixed(),!0),n.b.return(n.b.void()))),n.b.property("fail",n.b.function(n.b.param("error",n.b.union(n.b.ref("Error"),n.b.string())),n.b.return(n.b.void()))),n.b.property("succeed",n.b.union(n.b.function(n.b.param("messageOrObject",n.b.mixed()),n.b.return(n.b.void())),n.b.function(n.b.param("message",n.b.string()),n.b.param("object",n.b.mixed()),n.b.return(n.b.void())))))),o=n.b.type("CognitoIdentity",n.b.object(n.b.property("cognitoIdentityId",n.b.string()),n.b.property("cognitoIdentityPoolId",n.b.string()))),u=n.b.type("ClientContext",n.b.object(n.b.property("client",n.b.tdz(()=>s,"ClientContextClient")),n.b.property("Custom",n.b.mixed(),!0),n.b.property("env",n.b.tdz(()=>c,"ClientContextEnv")))),s=n.b.type("ClientContextClient",n.b.object(n.b.property("installationId",n.b.string()),n.b.property("appTitle",n.b.string()),n.b.property("appVersionName",n.b.string()),n.b.property("appVersionCode",n.b.string()),n.b.property("appPackageName",n.b.string()))),c=n.b.type("ClientContextEnv",n.b.object(n.b.property("platformVersion",n.b.string()),n.b.property("platform",n.b.string()),n.b.property("make",n.b.string()),n.b.property("model",n.b.string()),n.b.property("locale",n.b.string()))),p=n.b.type("Callback",t=>{var e=t.typeParameter("TResult",void 0,n.b.mixed());return n.b.function(n.b.param("error",n.b.union(n.b.ref("Error"),n.b.string(),n.b.null()),!0),n.b.param("result",e,!0),n.b.return(n.b.void()))}),y=n.b.type("APIGatewayEventRequestContext",n.b.object(n.b.property("accountId",n.b.string()),n.b.property("apiId",n.b.string()),n.b.property("authorizer",n.b.nullable(n.b.tdz(()=>f,"AuthResponseContext")),!0),n.b.property("connectedAt",n.b.number(),!0),n.b.property("connectionId",n.b.string(),!0),n.b.property("domainName",n.b.string(),!0),n.b.property("domainPrefix",n.b.string(),!0),n.b.property("eventType",n.b.string(),!0),n.b.property("extendedRequestId",n.b.string(),!0),n.b.property("protocol",n.b.string()),n.b.property("httpMethod",n.b.string()),n.b.property("identity",n.b.tdz(()=>l,"APIGatewayEventIdentity")),n.b.property("messageDirection",n.b.string(),!0),n.b.property("messageId",n.b.nullable(n.b.string()),!0),n.b.property("path",n.b.string()),n.b.property("stage",n.b.string()),n.b.property("requestId",n.b.string()),n.b.property("requestTime",n.b.string(),!0),n.b.property("requestTimeEpoch",n.b.number()),n.b.property("resourceId",n.b.string()),n.b.property("resourcePath",n.b.string()),n.b.property("routeKey",n.b.string(),!0))),l=n.b.type("APIGatewayEventIdentity",n.b.object(n.b.property("accessKey",n.b.nullable(n.b.string())),n.b.property("accountId",n.b.nullable(n.b.string())),n.b.property("apiKey",n.b.nullable(n.b.string())),n.b.property("apiKeyId",n.b.nullable(n.b.string())),n.b.property("caller",n.b.nullable(n.b.string())),n.b.property("cognitoAuthenticationProvider",n.b.nullable(n.b.string())),n.b.property("cognitoAuthenticationType",n.b.nullable(n.b.string())),n.b.property("cognitoIdentityId",n.b.nullable(n.b.string())),n.b.property("cognitoIdentityPoolId",n.b.nullable(n.b.string())),n.b.property("principalOrgId",n.b.nullable(n.b.string())),n.b.property("sourceIp",n.b.string()),n.b.property("user",n.b.nullable(n.b.string())),n.b.property("userAgent",n.b.nullable(n.b.string())),n.b.property("userArn",n.b.nullable(n.b.string())))),f=n.b.type("AuthResponseContext",n.b.object(n.b.indexer("key",n.b.string(),n.b.mixed()))),b=n.b.type("APIGatewayProxyHandler",n.b.ref(a,n.b.tdz(()=>d,"APIGatewayProxyEvent"),n.b.tdz(()=>g,"APIGatewayProxyResult"))),h=n.b.type("APIGatewayProxyCallback",n.b.ref(p,n.b.tdz(()=>g,"APIGatewayProxyResult"))),v=n.b.type("ProxyHandler",b),d=(n.b.type("ProxyCallback",h),n.b.type("APIGatewayEvent",n.b.tdz(()=>d,"APIGatewayProxyEvent")),n.b.type("ProxyResult",n.b.tdz(()=>g,"APIGatewayProxyResult")),n.b.type("APIGatewayProxyEvent",n.b.object(n.b.property("body",n.b.nullable(n.b.string())),n.b.property("headers",n.b.object(n.b.indexer("key",n.b.string(),n.b.string()))),n.b.property("multiValueHeaders",n.b.object(n.b.indexer("key",n.b.string(),n.b.array(n.b.string())))),n.b.property("httpMethod",n.b.string()),n.b.property("isBase64Encoded",n.b.boolean()),n.b.property("path",n.b.string()),n.b.property("pathParameters",n.b.nullable(n.b.object(n.b.indexer("key",n.b.string(),n.b.string())))),n.b.property("queryStringParameters",n.b.nullable(n.b.object(n.b.indexer("key",n.b.string(),n.b.string())))),n.b.property("multiValueQueryStringParameters",n.b.nullable(n.b.object(n.b.indexer("key",n.b.string(),n.b.array(n.b.string()))))),n.b.property("stageVariables",n.b.nullable(n.b.object(n.b.indexer("key",n.b.string(),n.b.string())))),n.b.property("requestContext",y),n.b.property("resource",n.b.string())))),g=n.b.type("APIGatewayProxyResult",n.b.object(n.b.property("statusCode",n.b.number()),n.b.property("headers",n.b.object(n.b.indexer("header",n.b.string(),n.b.union(n.b.boolean(),n.b.number(),n.b.string()))),!0),n.b.property("multiValueHeaders",n.b.object(n.b.indexer("header",n.b.string(),n.b.array(n.b.union(n.b.boolean(),n.b.number(),n.b.string())))),!0),n.b.property("body",n.b.string()),n.b.property("isBase64Encoded",n.b.boolean(),!0))),m=n.b.type("CustomAuthorizerHandler",n.b.ref(a,n.b.tdz(()=>k,"CustomAuthorizerEvent"),n.b.tdz(()=>_,"CustomAuthorizerResult"))),k=(n.b.type("CustomAuthorizerCallback",n.b.ref(p,n.b.tdz(()=>_,"CustomAuthorizerResult"))),n.b.type("CustomAuthorizerEvent",n.b.object(n.b.property("type",n.b.string()),n.b.property("methodArn",n.b.string()),n.b.property("authorizationToken",n.b.string(),!0),n.b.property("resource",n.b.string(),!0),n.b.property("path",n.b.string(),!0),n.b.property("httpMethod",n.b.string(),!0),n.b.property("headers",n.b.object(n.b.indexer("name",n.b.string(),n.b.string())),!0),n.b.property("multiValueHeaders",n.b.object(n.b.indexer("name",n.b.string(),n.b.array(n.b.string()))),!0),n.b.property("pathParameters",n.b.union(n.b.object(n.b.indexer("name",n.b.string(),n.b.string())),n.b.null()),!0),n.b.property("queryStringParameters",n.b.union(n.b.object(n.b.indexer("name",n.b.string(),n.b.string())),n.b.null()),!0),n.b.property("multiValueQueryStringParameters",n.b.union(n.b.object(n.b.indexer("name",n.b.string(),n.b.array(n.b.string()))),n.b.null()),!0),n.b.property("stageVariables",n.b.object(n.b.indexer("name",n.b.string(),n.b.string())),!0),n.b.property("requestContext",y,!0),n.b.property("domainName",n.b.string(),!0),n.b.property("apiId",n.b.string(),!0)))),_=n.b.type("CustomAuthorizerResult",n.b.object(n.b.property("principalId",n.b.string()),n.b.property("policyDocument",n.b.tdz(()=>E,"PolicyDocument")),n.b.property("context",f,!0),n.b.property("usageIdentifierKey",n.b.string(),!0))),E=(n.b.type("AuthResponse",_),n.b.type("PolicyDocument",n.b.object(n.b.property("Version",n.b.string()),n.b.property("Id",n.b.string(),!0),n.b.property("Statement",n.b.array(n.b.tdz(()=>S,"Statement")))))),T=n.b.type("ConditionBlock",n.b.object(n.b.indexer("condition",n.b.string(),n.b.union(n.b.tdz(()=>O,"Condition"),n.b.array(n.b.tdz(()=>O,"Condition")))))),O=n.b.type("Condition",n.b.object(n.b.indexer("key",n.b.string(),n.b.union(n.b.string(),n.b.array(n.b.string()))))),S=n.b.type("Statement",n.b.intersection(n.b.tdz(()=>j,"BaseStatement"),n.b.tdz(()=>A,"StatementAction"),n.b.union(n.b.tdz(()=>x,"StatementResource"),n.b.tdz(()=>C,"StatementPrincipal")))),j=n.b.type("BaseStatement",n.b.object(n.b.property("Effect",n.b.string()),n.b.property("Sid",n.b.string(),!0),n.b.property("Condition",T,!0))),P=n.b.type("PrincipalValue",n.b.union(n.b.object(n.b.indexer("key",n.b.string(),n.b.union(n.b.string(),n.b.array(n.b.string())))),n.b.string(),n.b.array(n.b.string()))),w=n.b.type("MaybeStatementPrincipal",n.b.object(n.b.property("Principal",P,!0),n.b.property("NotPrincipal",P,!0))),N=n.b.type("MaybeStatementResource",n.b.object(n.b.property("Resource",n.b.union(n.b.string(),n.b.array(n.b.string())),!0),n.b.property("NotResource",n.b.union(n.b.string(),n.b.array(n.b.string())),!0))),A=n.b.type("StatementAction",n.b.union(n.b.object(n.b.property("Action",n.b.union(n.b.string(),n.b.array(n.b.string())))),n.b.object(n.b.property("NotAction",n.b.union(n.b.string(),n.b.array(n.b.string())))))),x=n.b.type("StatementResource",n.b.intersection(w,n.b.union(n.b.object(n.b.property("Resource",n.b.union(n.b.string(),n.b.array(n.b.string())))),n.b.object(n.b.property("NotResource",n.b.union(n.b.string(),n.b.array(n.b.string()))))))),C=n.b.type("StatementPrincipal",n.b.intersection(N,n.b.union(n.b.object(n.b.property("Principal",P)),n.b.object(n.b.property("NotPrincipal",P))))),R=n.b.type("ScheduledHandler",n.b.ref(a,n.b.tdz(()=>I,"ScheduledEvent"),n.b.void())),I=n.b.type("ScheduledEvent",n.b.object(n.b.property("account",n.b.string()),n.b.property("region",n.b.string()),n.b.property("detail",n.b.mixed()),n.b.property("source",n.b.string()),n.b.property("time",n.b.string()),n.b.property("id",n.b.string()),n.b.property("resources",n.b.array(n.b.string())),n.b.indexer("key",n.b.string("detail-type"),n.b.string())))},function(t,e){t.exports=require("ioredis")},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(5),a=r(1),i=r(0),o=i.b.tdz(()=>a.p),u=i.b.tdz(()=>n.a),s=i.b.annotate((function(t){var{quantities:e}=t;return{[a.n]:null!=e[a.n]?e[a.n]:0,[a.o]:null!=e[a.o]?e[a.o]:0}}),i.b.function(i.b.param("_arg",i.b.object(i.b.property("quantities",i.b.ref(u)))),i.b.return(i.b.object(i.b.indexer("key",i.b.ref(o),i.b.number())))))},function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return c}));var n=r(17),a=r.n(n),i=r(0),o=i.b.type("ApiGatewayPromise",i.b.function(i.b.return(i.b.ref("Promise",i.b.void())))),u=i.b.type("PostToConnection",i.b.function(i.b.param("_arg0",i.b.object(i.b.property("ConnectionId",i.b.string()),i.b.property("Data",i.b.string()))),i.b.return(i.b.object(i.b.property("promise",o))))),s=i.b.type("ApiGateway",i.b.object(i.b.property("postToConnection",u))),c=i.b.annotate((function(){return new a.a.ApiGatewayManagementApi({apiVersion:"2018-11-29",endpoint:process.env.API_GATEWAY_ENDPOINT})}),i.b.function(i.b.return(s)))},function(t,e,r){var n=r(18),a=r(14),i=r(20),o=r(21).isError,u=i.sprintf;function s(t){var e,r,a,i;if(n.object(t,"args"),n.bool(t.strict,"args.strict"),n.array(t.argv,"args.argv"),0===(e=t.argv).length)r={},a=[];else if(o(e[0]))r={cause:e[0]},a=e.slice(1);else if("object"==typeof e[0]){for(i in r={},e[0])r[i]=e[0][i];a=e.slice(1)}else n.string(e[0],"first argument to VError, SError, or WError constructor must be a string, object, or Error"),r={},a=e;return n.object(r),r.strict||t.strict||(a=a.map((function(t){return null===t?"null":void 0===t?"undefined":t}))),{options:r,shortmessage:0===a.length?"":u.apply(null,a)}}function c(){var t,e,r,a,i,u,p;if(t=Array.prototype.slice.call(arguments,0),!(this instanceof c))return e=Object.create(c.prototype),c.apply(e,arguments),e;if((r=s({argv:t,strict:!1})).options.name&&(n.string(r.options.name,'error\'s "name" must be a string'),this.name=r.options.name),this.jse_shortmsg=r.shortmessage,u=r.shortmessage,(a=r.options.cause)&&(n.ok(o(a),"cause is not an Error"),this.jse_cause=a,r.options.skipCauseMessage||(u+=": "+a.message)),this.jse_info={},r.options.info)for(p in r.options.info)this.jse_info[p]=r.options.info[p];return this.message=u,Error.call(this,u),Error.captureStackTrace&&(i=r.options.constructorOpt||this.constructor,Error.captureStackTrace(this,i)),this}function p(){var t,e,r,n;return t=Array.prototype.slice.call(arguments,0),this instanceof p?(n=(r=s({argv:t,strict:!0})).options,c.call(this,n,"%s",r.shortmessage),this):(e=Object.create(p.prototype),p.apply(e,arguments),e)}function y(t){n.array(t,"list of errors"),n.ok(t.length>0,"must be at least one error"),this.ase_errors=t,c.call(this,{cause:t[0]},"first of %d error%s",t.length,1==t.length?"":"s")}function l(){var t,e,r,n;return t=Array.prototype.slice.call(arguments,0),this instanceof l?((n=(r=s({argv:t,strict:!1})).options).skipCauseMessage=!0,c.call(this,n,"%s",r.shortmessage),this):(e=Object.create(l.prototype),l.apply(e,t),e)}t.exports=c,c.VError=c,c.SError=p,c.WError=l,c.MultiError=y,a.inherits(c,Error),c.prototype.name="VError",c.prototype.toString=function(){var t=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t+=": "+this.message),t},c.prototype.cause=function(){var t=c.cause(this);return null===t?void 0:t},c.cause=function(t){return n.ok(o(t),"err must be an Error"),o(t.jse_cause)?t.jse_cause:null},c.info=function(t){var e,r,a;if(n.ok(o(t),"err must be an Error"),e=null!==(r=c.cause(t))?c.info(r):{},"object"==typeof t.jse_info&&null!==t.jse_info)for(a in t.jse_info)e[a]=t.jse_info[a];return e},c.findCauseByName=function(t,e){var r;for(n.ok(o(t),"err must be an Error"),n.string(e,"name"),n.ok(e.length>0,"name cannot be empty"),r=t;null!==r;r=c.cause(r))if(n.ok(o(r)),r.name==e)return r;return null},c.hasCauseWithName=function(t,e){return null!==c.findCauseByName(t,e)},c.fullStack=function(t){n.ok(o(t),"err must be an Error");var e=c.cause(t);return e?t.stack+"\ncaused by: "+c.fullStack(e):t.stack},c.errorFromList=function(t){return n.arrayOfObject(t,"errors"),0===t.length?null:(t.forEach((function(t){n.ok(o(t))})),1==t.length?t[0]:new y(t))},c.errorForEach=function(t,e){n.ok(o(t),"err must be an Error"),n.func(e,"func"),t instanceof y?t.errors().forEach((function(t){e(t)})):e(t)},a.inherits(p,c),a.inherits(y,c),y.prototype.name="MultiError",y.prototype.errors=function(){return this.ase_errors.slice(0)},a.inherits(l,c),l.prototype.name="WError",l.prototype.toString=function(){var t=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t+=": "+this.message),this.jse_cause&&this.jse_cause.message&&(t+="; caused by "+this.jse_cause.toString()),t},l.prototype.cause=function(t){return o(t)&&(this.jse_cause=t),this.jse_cause}},function(t,e){t.exports=require("crypto")},function(t,e,r){"use strict";r.d(e,"a",(function(){return y}));var n=r(6),a=r(4),i=r(11),o=r.n(i),u=r(1),s=r(0),c=s.b.tdz(()=>u.e),p=s.b.tdz(()=>a.a),y=s.b.annotate((async function(t){var{redis:e}=t;try{var r=await e.get("state"),a=Object(n.a)({json:r});return u.j.assert(a)}catch(t){throw new o.a.VError({name:"GetStateError",cause:t},"could not retrieve the current state")}}),s.b.function(s.b.param("_arg",s.b.object(s.b.property("redis",s.b.ref(p)))),s.b.return(s.b.ref("Promise",s.b.ref(c)))))},function(t,e){t.exports=require("util")},function(t,e,r){"use strict";var n=r(2),a=r(11),i=r.n(a),o=r(10),u=r(4),s=r(13),c=r(6),p=r(1),y=r(0),l=y.b.tdz(()=>p.e),f=y.b.tdz(()=>o.a),b=y.b.tdz(()=>n.i),h=y.b.tdz(()=>u.a),v=(y.b.annotate((async function(t){var{redis:e}=t,r=await e.get("state"),n=Object(c.a)({json:r});return p.j.assert(n)}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("redis",y.b.ref(h)))),y.b.return(y.b.ref("Promise",y.b.ref(l))))),y.b.annotate((async function(t){var{apiGateway:e,connectionId:r,response:n}=t,a=Object(c.b)({value:n});if(null==a)throw Error("missing server response");return await e.postToConnection({ConnectionId:r,Data:a}).promise()}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("apiGateway",y.b.ref(f)),y.b.property("connectionId",y.b.string()),y.b.property("response",y.b.ref(b)))),y.b.return(y.b.ref("Promise",y.b.void()))))),d=y.b.tdz(()=>p.e),g=y.b.tdz(()=>p.f),m=y.b.tdz(()=>Pt),k=y.b.tdz(()=>n.h),_=y.b.annotate((function(t){var{action:e,state:r}=t;return Nt({state:p.D.cities})}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(k)),y.b.property("state",y.b.ref(d)))),y.b.return(y.b.ref(m,y.b.ref(g))))),E=y.b.tdz(()=>p.e),T=y.b.tdz(()=>p.f),O=y.b.tdz(()=>Pt),S=y.b.tdz(()=>n.a),j=y.b.annotate((function(t){var{action:e,state:r}=t,{cityId:n,playerId:a}=e.payload,i=r.cities[n];if(null==i)return At({errors:["the city does not exist"]});if(a!==i.ownerId)return At({errors:["the city does not belong to the player"]});var o={...i,ownerId:null},u={...r.cities,[n]:o};return Nt({state:u})}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(S)),y.b.property("state",y.b.ref(E)))),y.b.return(y.b.ref(O,y.b.ref(T))))),P=y.b.annotate((function(t){var{name:e}=t;return e.length<3?["the city name is too short"]:e.length>20?["the city name is too long"]:null==e.match(/^[A-Z][a-z]+$/)?["the city name does not follow the convention"]:[]}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("name",y.b.string()))),y.b.return(y.b.ref("$ReadOnlyArray",y.b.string())))),w=y.b.tdz(()=>p.e),N=y.b.tdz(()=>p.f),A=y.b.tdz(()=>Pt),x=y.b.tdz(()=>n.c),C=y.b.annotate((function(t){var{action:e,state:r}=t,{cityId:n,name:a,playerId:i}=e.payload,o=r.cities[n];if(null==o)return At({errors:["the city does not exist"]});if(i!==o.ownerId)return At({errors:["the city does not belong to the player"]});var u=P({name:a});if(u.length>0)return At({errors:u});var s={...o,name:e.payload.name},c={...r.cities,[n]:s};return Nt({state:c})}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(x)),y.b.property("state",y.b.ref(w)))),y.b.return(y.b.ref(A,y.b.ref(N))))),R=r(9),I=r(5),$=y.b.tdz(()=>p.e),M=y.b.tdz(()=>p.f),z=(y.b.tdz(()=>p.g),y.b.tdz(()=>p.p)),D=y.b.tdz(()=>Pt),W=y.b.tdz(()=>n.j),U=y.b.annotate((function(t){var{action:e,state:r}=t,{buildingType:n,cityId:a,playerId:i}=e.payload,o=r.cities[a];if(null==o)return At({errors:["the city does not exist"]});if(i!==o.ownerId)return At({errors:["the city does not belong to the player"]});var{buildings:u,resources:s}=o,c=u[n],l=Object(p.y)({buildingTier:c.tier,buildingType:n,rules:r.rules}),f=Object.keys(s).reduce(y.b.annotate((t,e)=>({...t,[e]:s[e]}),y.b.function(y.b.param("availableResources",y.b.any()),y.b.param("resourceType",y.b.ref(z)))),{}),b=Object(R.a)({quantities:Object(I.c)({quantities1:f,quantities2:l})}),h=Object.keys(b).filter(t=>b[t]<0).map(t=>`insufficient ${t}`);if(h.length>0)return At({errors:h});var v=Object(R.a)({quantities:Object(I.c)({quantities1:f,quantities2:l})}),d={...o,buildings:{...o.buildings,[n]:{...o.buildings[n],tier:o.buildings[n].tier+1}},resources:v},g={...r.cities,[a]:d};return Nt({state:g})}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(W)),y.b.property("state",y.b.ref($)))),y.b.return(y.b.ref(D,y.b.ref(M))))),X=y.b.tdz(()=>p.e),J=y.b.tdz(()=>p.f),B=(y.b.tdz(()=>p.l),y.b.tdz(()=>Pt)),G=y.b.tdz(()=>n.e),L=y.b.annotate((function(t){var{action:e,state:r}=t,n=(Date.parse(e.payload)-Date.parse(r.time))/1e3;if(n<=0)return At({errors:["the time from the action is not past the time from the state"]});var a=Object.keys(r.cities).reduce((t,e)=>{var a=r.cities[e],i=Object(p.B)({changeInfo:Object(p.A)({city:a,resourceType:p.n,rules:r.rules})}),o=Object(p.B)({changeInfo:Object(p.A)({city:a,resourceType:p.o,rules:r.rules})}),u=Math.max(0,a.resources[p.n]+Object(p.C)({changeRate:i,timeDelta:n})),s=Math.max(0,a.resources[p.o]+Object(p.C)({changeRate:o,timeDelta:n})),c={[p.n]:u,[p.o]:s},y=Object(p.x)({buildings:a.buildings}),l=Object(p.z)({buildingTiersSum:y,unitsQuantity:a.units[p.u],food:u,foodChangeRate:i,rules:r.rules}),f=Math.max(0,a.units[p.u]+Math.floor(Object(p.C)({changeRate:Object(p.B)({changeInfo:l}),timeDelta:n}))),b={...a.units,[p.u]:f};return{...t,[e]:{...a,units:b,resources:c}}},{});return Nt({state:a})}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(G)),y.b.property("state",y.b.ref(X)))),y.b.return(y.b.ref(B,y.b.ref(J))))),q=y.b.tdz(()=>p.e),F=y.b.tdz(()=>p.f),V=y.b.tdz(()=>Pt),Y=y.b.tdz(()=>n.b),H=(y.b.tdz(()=>n.h),y.b.annotate((function(t){var{action:e,state:r}=t;return Nt({state:r.cities})}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(Y)),y.b.property("state",y.b.ref(q)))),y.b.return(y.b.ref(V,y.b.ref(F))))));function K(t,e){return t===e}function Q(t,e,r){if(null===e||null===r||e.length!==r.length)return!1;for(var n=e.length,a=0;a<n;a++)if(!t(e[a],r[a]))return!1;return!0}function Z(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every((function(t){return"function"==typeof t}))){var r=e.map((function(t){return typeof t})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+r+"]")}return e}var tt=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];var i=0,o=n.pop(),u=Z(n),s=t.apply(void 0,[function(){return i++,o.apply(null,arguments)}].concat(r)),c=t((function(){for(var t=[],e=u.length,r=0;r<e;r++)t.push(u[r].apply(null,arguments));return s.apply(null,t)}));return c.resultFunc=o,c.dependencies=u,c.recomputations=function(){return i},c.resetRecomputations=function(){return i=0},c}}((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K,r=null,n=null;return function(){return Q(e,r,arguments)||(n=t.apply(null,arguments)),r=arguments,n}}));var et=r(3),rt=y.b.tdz(()=>et.a),nt=y.b.tdz(()=>p.e),at=y.b.tdz(()=>p.f),it=(y.b.tdz(()=>p.g),y.b.tdz(()=>p.h)),ot=y.b.tdz(()=>p.i),ut=(y.b.tdz(()=>p.k),y.b.tdz(()=>p.m)),st=y.b.annotate((function(t){return t.cities}),y.b.function(y.b.param("state",y.b.ref(nt)),y.b.return(y.b.ref(at)))),ct=y.b.annotate((function(t){return t.rules}),y.b.function(y.b.param("state",y.b.ref(nt)),y.b.return(y.b.ref(it)))),pt=(y.b.annotate((function(t){return t.time}),y.b.function(y.b.param("state",y.b.ref(nt)),y.b.return(y.b.ref(ot)))),y.b.annotate((function(t){return t.world}),y.b.function(y.b.param("state",y.b.ref(nt)),y.b.return(y.b.ref(ut))))),yt=tt(st,t=>Object.keys(t).reduce((e,r)=>{var n=t[r].ownerId;if(null==n)return e;var a=e[n],i=[...null==a?[]:[...a],r];return{...e,[n]:i}},Object.freeze({}))),lt=(tt(st,yt,(t,e)=>Object.keys(e).reduce((r,n)=>({...r,[n]:e[n].map(e=>t[e])}),Object.freeze({}))),tt(ct,t=>t.unitStats),tt(st,ct,pt,(t,e,r)=>{for(var n=Object.keys(t).map(e=>t[e].location),a=y.b.annotate((function(t){var{location:e}=t;return`${e.x}_${e.y}`}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("location",y.b.ref(rt)))),y.b.return(y.b.string()))),i=y.b.annotate((function(t){for(var{location:n}=t,i=-e.minimalCityMargin.y;i<=e.minimalCityMargin.y;i++)for(var u=-e.minimalCityMargin.x;u<=e.minimalCityMargin.x;u++){var s={x:u,y:i},c=Object(et.b)({vector1:n,vector2:s});if(c.x<-r.size.x)return!1;if(c.x>r.size.x)return!1;if(c.y<-r.size.y)return!1;if(c.y>r.size.y)return!1;if(!0===o[a({location:c})])return!1}return!0}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("location",y.b.ref(rt)))),y.b.return(y.b.boolean()))),o=n.reduce((t,e)=>({...t,[a({location:e})]:!0}),{}),u=[],s=-r.size.y;s<=r.size.y;s++)for(var c=-r.size.x;c<=r.size.x;c++){var p={x:c,y:s};i({location:p})&&u.push(p)}return u.sort((t,e)=>Object(et.c)({vector1:et.d,vector2:t})-Object(et.c)({vector1:et.d,vector2:e})),u.length>0?u[0]:null})),ft=y.b.tdz(()=>p.e),bt=y.b.tdz(()=>p.f),ht=(y.b.tdz(()=>p.g),y.b.tdz(()=>Pt)),vt=y.b.tdz(()=>n.d),dt=y.b.annotate((function(t){var{action:e,state:r}=t,{cityId:n,cityName:a,playerId:i}=e.payload,o=P({name:a});if(o.length>0)return At({errors:o});if(null!=Object.keys(r.cities).find(t=>r.cities[t].ownerId===i))return At({errors:["player already owns a city"]});var u=lt(r);if(null==u)return At({errors:["there is no space for another city"]});var s={buildings:{[p.a]:{tier:0},[p.b]:{tier:0},[p.c]:{tier:0}},location:u,name:a,ownerId:i,resources:{[p.n]:0,[p.o]:0},units:{[p.q]:0,[p.r]:0,[p.s]:0,[p.t]:0,[p.u]:0,[p.v]:0,[p.w]:0}},c={...r.cities,[n]:s};return Nt({state:c})}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(vt)),y.b.property("state",y.b.ref(ft)))),y.b.return(y.b.ref(ht,y.b.ref(bt))))),gt=y.b.tdz(()=>p.e),mt=(y.b.tdz(()=>p.f),y.b.tdz(()=>n.b)),kt=(y.b.tdz(()=>wt),y.b.annotate((function(t){var{action:e,state:r}=t;switch(e.type){case"ABANDON_CITY":return j({action:e,state:r});case"CHANGE_CITY_NAME":return C({action:e,state:r});case"CREATE_CITY":return dt({action:e,state:r});case"EXECUTE_TIME_STEP":return L({action:e,state:r});case"RESET_STATE":return _({action:e,state:r});case"UPGRADE_BUILDING":return U({action:e,state:r});default:return H({action:e,state:r})}}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(mt)),y.b.property("state",y.b.ref(gt))))))),_t=(y.b.tdz(()=>p.h),y.b.tdz(()=>wt),y.b.tdz(()=>p.i),y.b.tdz(()=>wt),y.b.tdz(()=>p.m),y.b.tdz(()=>wt),y.b.tdz(()=>p.e)),Et=y.b.tdz(()=>p.f),Tt=y.b.tdz(()=>p.h),Ot=y.b.tdz(()=>p.i),St=y.b.tdz(()=>p.m),jt=y.b.tdz(()=>n.b),Pt=y.b.type("CommonStateReducerResult",t=>{var e=t.typeParameter("S");return y.b.object(y.b.property("errors",y.b.ref("$ReadOnlyArray",y.b.string())),y.b.property("state",y.b.nullable(e)))}),wt=y.b.type("CommonStateReducer",t=>{var e=t.typeParameter("S");return y.b.function(y.b.param("_arg0",y.b.object(y.b.property("action",y.b.ref(jt)),y.b.property("state",y.b.ref(_t)))),y.b.return(y.b.ref(Pt,e)))}),Nt=y.b.annotate((function(t){var{state:e}=t;return{state:e,errors:[]}}),y.b.function(t=>{var e=t.typeParameter("S");return[y.b.param("_arg",y.b.object(y.b.property("state",y.b.flowInto(e)))),y.b.return(y.b.ref(Pt,e))]})),At=y.b.annotate((function(t){var{errors:e}=t;return{state:null,errors:e}}),y.b.function(t=>{var e=t.typeParameter("S");return[y.b.param("_arg",y.b.object(y.b.property("errors",y.b.ref("$ReadOnlyArray",y.b.string())))),y.b.return(y.b.ref(Pt,e))]})),xt=y.b.type("StateToReducersMapping",y.b.object(y.b.property("cities",y.b.ref(wt,y.b.ref(Et))),y.b.property("rules",y.b.ref(wt,y.b.ref(Tt))),y.b.property("time",y.b.ref(wt,y.b.ref(Ot))),y.b.property("world",y.b.ref(wt,y.b.ref(St))))),Ct=y.b.annotate((function(t){var{stateToReducersMapping:e}=t;return({action:t,state:r})=>{var n=Object.keys(e).reduce(y.b.annotate((t,e)=>({...t,[e]:r[e]}),y.b.function(y.b.param("reducibleState",y.b.any()),y.b.param("stateProperty",y.b.$keys(xt)))),{});return Object.keys(e).reduce(y.b.annotate((r,n)=>{var a=(0,e[n])({action:t,state:r.state});return{errors:[...r.errors,...a.errors],state:{...r.state,[n]:a.state}}},y.b.function(y.b.param("result",y.b.any()),y.b.param("stateProperty",y.b.string()))),{errors:[],state:n})}}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("stateToReducersMapping",xt)))))({stateToReducersMapping:{cities:kt,rules:({action:t,state:e})=>{switch(t.type){case"RESET_STATE":return Nt({state:p.D.rules});default:return Nt({state:e.rules})}},time:({action:t,state:e})=>{switch(t.type){case"RESET_STATE":return Nt({state:p.D.time});case"EXECUTE_TIME_STEP":return Nt({state:t.payload});default:return Nt({state:e.time})}},world:({action:t,state:e})=>{switch(t.type){case"RESET_STATE":return Nt({state:p.D.world});default:return Nt({state:e.world})}}}});r.d(e,"b",(function(){return Dt})),r.d(e,"a",(function(){return Ut}));var Rt=y.b.tdz(()=>p.e),It=y.b.tdz(()=>u.a),$t=y.b.tdz(()=>o.a),Mt=y.b.tdz(()=>n.b),zt=y.b.tdz(()=>n.i),Dt=y.b.annotate((async function(t){var{apiGateway:e,redis:r,connectionId:n,response:a}=t;try{console.group("sending response"),console.info("sending response back to the api gateway"),await v({apiGateway:e,connectionId:n,response:a})}catch(t){if(410===t.statusCode){console.info(`Found stale connection, deleting ${n}`);try{await r.srem("connection-ids",n)}catch(t){console.error(t.stack)}}else console.error(t.stack);throw t}finally{console.groupEnd()}}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("apiGateway",y.b.ref($t)),y.b.property("redis",y.b.ref(It)),y.b.property("connectionId",y.b.string()),y.b.property("response",y.b.ref(zt)))),y.b.return(y.b.ref("Promise",y.b.void())))),Wt=y.b.annotate((function(t){var{state:e}=t;return JSON.stringify(e)}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("state",y.b.ref(Rt)))),y.b.return(y.b.string()))),Ut=y.b.annotate((async function(t){var{action:e,redis:r}=t;try{console.group("executing action");for(var n=0;n<3;n++){console.group(`optimistic locking attempt ${n+1}/3`),console.info("watching state"),await r.watch("state");var a=await Object(s.a)({redis:r});console.info("applying action to the state");var o=Ct({action:e,state:a});if(o.errors.length>0)return console.info("returning validation error"),{state:a,errors:o.errors,request:e};var u=o.state;if(null==u)throw Error("new state missing");console.info("serializing state");var c=Wt({state:u});if(console.info("persisting new state"),null!=await r.multi().set("state",c).exec())return{state:u,errors:[],request:e};console.info("concurrent state modification detected - retrying")}throw Error("optimistic locking failed after 3 attempts")}catch(t){throw new i.a.VError({name:"ActionExecutionError",cause:t},"execution failed")}finally{console.groupEnd(),console.groupEnd()}}),y.b.function(y.b.param("_arg",y.b.object(y.b.property("action",y.b.ref(Mt)),y.b.property("redis",y.b.ref(It)))),y.b.return(y.b.ref("Promise",y.b.ref(zt)))))},function(t,e){t.exports=require("assert")},function(t,e){t.exports=require("aws-sdk")},function(t,e,r){var n=r(16),a=r(19).Stream,i=r(14),o=/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/;function u(t){return t.charAt(0).toUpperCase()+t.slice(1)}function s(t,e,r,a,o){throw new n.AssertionError({message:i.format("%s (%s) is required",t,e),actual:void 0===o?typeof a:o(a),expected:e,operator:r||"===",stackStartFunction:s.caller})}function c(t){return Object.prototype.toString.call(t).slice(8,-1)}function p(){}var y={bool:{check:function(t){return"boolean"==typeof t}},func:{check:function(t){return"function"==typeof t}},string:{check:function(t){return"string"==typeof t}},object:{check:function(t){return"object"==typeof t&&null!==t}},number:{check:function(t){return"number"==typeof t&&!isNaN(t)}},finite:{check:function(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)}},buffer:{check:function(t){return Buffer.isBuffer(t)},operator:"Buffer.isBuffer"},array:{check:function(t){return Array.isArray(t)},operator:"Array.isArray"},stream:{check:function(t){return t instanceof a},operator:"instanceof",actual:c},date:{check:function(t){return t instanceof Date},operator:"instanceof",actual:c},regexp:{check:function(t){return t instanceof RegExp},operator:"instanceof",actual:c},uuid:{check:function(t){return"string"==typeof t&&o.test(t)},operator:"isUUID"}};t.exports=function t(e){var r,a=Object.keys(y);return r=process.env.NODE_NDEBUG?p:function(t,e){t||s(e,"true",t)},a.forEach((function(t){if(e)r[t]=p;else{var n=y[t];r[t]=function(e,r){n.check(e)||s(r,t,n.operator,e,n.actual)}}})),a.forEach((function(t){var n="optional"+u(t);if(e)r[n]=p;else{var a=y[t];r[n]=function(e,r){null!=e&&(a.check(e)||s(r,t,a.operator,e,a.actual))}}})),a.forEach((function(t){var n="arrayOf"+u(t);if(e)r[n]=p;else{var a=y[t],i="["+t+"]";r[n]=function(t,e){var r;for(Array.isArray(t)||s(e,i,a.operator,t,a.actual),r=0;r<t.length;r++)a.check(t[r])||s(e,i,a.operator,t,a.actual)}}})),a.forEach((function(t){var n="optionalArrayOf"+u(t);if(e)r[n]=p;else{var a=y[t],i="["+t+"]";r[n]=function(t,e){var r;if(null!=t)for(Array.isArray(t)||s(e,i,a.operator,t,a.actual),r=0;r<t.length;r++)a.check(t[r])||s(e,i,a.operator,t,a.actual)}}})),Object.keys(n).forEach((function(t){r[t]="AssertionError"!==t&&e?p:n[t]})),r._setExports=t,r}(process.env.NODE_NDEBUG)},function(t,e){t.exports=require("stream")},function(t,e,r){var n=r(16),a=r(14);function i(t){var e,r,i,o,c,p,y,l,f,b=["([^%]*)","%","(['\\-+ #0]*?)","([1-9]\\d*)?","(\\.([1-9]\\d*))?","[lhjztL]*?","([diouxXfFeEgGaAcCsSp%jr])"].join(""),h=new RegExp(b),v=Array.prototype.slice.call(arguments,1),d="",g=1;for(n.equal("string",typeof t);null!==(f=h.exec(t));)if(d+=f[1],t=t.substring(f[0].length),e=f[2]||"",r=f[3]||0,i=f[4]||"",c=!1,y=!1,p=" ","%"!=(o=f[6])){if(0===v.length)throw new Error("too few args to sprintf");if(l=v.shift(),g++,e.match(/[\' #]/))throw new Error("unsupported flags: "+e);if(i.length>0)throw new Error("non-zero precision not supported");switch(e.match(/-/)&&(c=!0),e.match(/0/)&&(p="0"),e.match(/\+/)&&(y=!0),o){case"s":if(null==l)throw new Error("argument "+g+": attempted to print undefined or null as a string");d+=u(p,r,c,l.toString());break;case"d":l=Math.floor(l);case"f":d+=(y=y&&l>0?"+":"")+u(p,r,c,l.toString());break;case"x":d+=u(p,r,c,l.toString(16));break;case"j":0===r&&(r=10),d+=a.inspect(l,!1,r);break;case"r":d+=s(l);break;default:throw new Error("unsupported conversion: "+o)}}else d+="%";return d+=t}function o(t){var e=Array.prototype.slice.call(arguments,1);return t.write(i.apply(this,e))}function u(t,e,r,n){for(var a=n;a.length<e;)r?a+=t:a=t+a;return a}function s(t){var e;if(!(t instanceof Error))throw new Error(i("invalid type for %%r: %j",t));if(e="EXCEPTION: "+t.constructor.name+": "+t.stack,t.cause&&"function"==typeof t.cause){var r=t.cause();r&&(e+="\nCaused by: "+s(r))}return e}e.sprintf=i,e.printf=function(){var t=Array.prototype.slice.call(arguments);t.unshift(process.stdout),o.apply(null,t)},e.fprintf=o},function(t,e){function r(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===r(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===r(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===r(t)},e.isError=function(t){return"[object Error]"===r(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=Buffer.isBuffer},,,,,,function(t,e,r){"use strict";r.r(e),r.d(e,"handler",(function(){return p}));var n=r(15),a=r(10),i=r(4),o=r(2),u=r(7),s=(r(0).b.tdz(()=>u.c),Object(a.b)()),c=Object(i.b)(),p=async(t,e)=>{try{var r=await Object(n.a)({action:Object(o.k)({time:(new Date).toISOString()}),redis:c}),a=(await c.smembers("connection-ids")).map(t=>Object(n.b)({apiGateway:s,redis:c,connectionId:t,response:r}));await Promise.all(a)}catch(t){console.error(t.stack)}}}]);
//# sourceMappingURL=app.js.map